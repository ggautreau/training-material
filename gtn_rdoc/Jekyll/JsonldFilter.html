<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Jekyll::JsonldFilter - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-i-generate_dublin_core">#generate_dublin_core</a>
    <li ><a href="#method-i-generate_event_jsonld">#generate_event_jsonld</a>
    <li ><a href="#method-i-generate_funder_jsonld">#generate_funder_jsonld</a>
    <li ><a href="#method-i-generate_grant_jsonld">#generate_grant_jsonld</a>
    <li ><a href="#method-i-generate_learning_pathway_jsonld">#generate_learning_pathway_jsonld</a>
    <li ><a href="#method-i-generate_material_jsonld">#generate_material_jsonld</a>
    <li ><a href="#method-i-generate_news_jsonld">#generate_news_jsonld</a>
    <li ><a href="#method-i-generate_org_jsonld">#generate_org_jsonld</a>
    <li ><a href="#method-i-generate_person_jsonld">#generate_person_jsonld</a>
    <li ><a href="#method-i-to_jsonld">#to_jsonld</a>
    <li ><a href="#method-i-to_pfo_jsonld">#to_pfo_jsonld</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Jekyll::JsonldFilter">
  <h1 id="module-Jekyll::JsonldFilter" class="module">
    module Jekyll::JsonldFilter
  </h1>

  <section class="description">
    
<p>Generate JSON-LD metadata for the <a href="JsonldFilter.html#GTN"><code>GTN</code></a>.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">


    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
        <dt id="A11Y">A11Y
        <dd>
        <dt id="EDU_ROLES">EDU_ROLES
        <dd>
        <dt id="GTN">GTN
        <dd>
      </dl>
    </section>



     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-generate_dublin_core" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_dublin_core</span><span
              class="method-args">(material, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Generate the Dublin Core metadata for a material. Parmaeters:</p>
<dl class="rdoc-list note-list"><dt><code>material</code>
<dd>
<p>The material to generate the metadata for.</p>
</dd><dt><code>site</code>
<dd>
<p>The site object.</p>
</dd></dl>

<p>Returns: A string containing the metadata.</p>

<p>Example:</p>

<pre>{{ material | generate_dublin_core: site }}
=&gt; &lt;meta name=&quot;DC.identifier&quot; content=&quot;...&quot; /&gt;</pre>

          <div class="method-source-code" id="generate_dublin_core-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_dublin_core</span>(<span class="ruby-identifier">material</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;data&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;data&#39;</span>].<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;type&#39;</span>, <span class="ruby-string">&#39;none&#39;</span>) <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;tutorial_hands_on&#39;</span>

  <span class="ruby-identifier">attributes</span> = [
    [<span class="ruby-string">&#39;DC.identifier&#39;</span>, <span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;github_repository&#39;</span>]],
    [<span class="ruby-string">&#39;DC.type&#39;</span>, <span class="ruby-string">&#39;text&#39;</span>],
    [<span class="ruby-string">&#39;DC.title&#39;</span>, <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;title&#39;</span>]],
    [<span class="ruby-string">&#39;DC.publisher&#39;</span>, <span class="ruby-string">&#39;Galaxy Training Network&#39;</span>],
    [<span class="ruby-string">&#39;DC.date&#39;</span>, <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;path&#39;</span>])]
  ]

  <span class="ruby-identifier">attributes</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_authors</span>(<span class="ruby-identifier">material</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
    [<span class="ruby-string">&#39;DC.creator&#39;</span>, <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_name</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">user</span>)]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;&lt;meta name=\&quot;#{a}\&quot; content=\&quot;#{b}\&quot;&gt;&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_event_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_event_jsonld</span><span
              class="method-args">(page, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Generate the JSON-LD metadata for an event Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>page</code>
<dd>
<p>The page object.</p>
</dd><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> site object.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The JSON-LD metadata.</p>
</dd></dl>

          <div class="method-source-code" id="generate_event_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_event_jsonld</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">organisers</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_organisers</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">to_h</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">instructors</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_instructors</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">to_h</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">funders</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_funders</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">page</span>.<span class="ruby-identifier">to_h</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">funding</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_grants</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">page</span>.<span class="ruby-identifier">to_h</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">materials</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;program&#39;</span>]
    <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;program&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">section</span>.<span class="ruby-identifier">key?</span> <span class="ruby-string">&#39;tutorials&#39;</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">section</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tutorial</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">tutorial</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;custom&#39;</span>)
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">material</span> = <span class="ruby-constant">TopicFilter</span>.<span class="ruby-identifier">fetch_tutorial_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tutorial</span>[<span class="ruby-string">&#39;topic&#39;</span>], <span class="ruby-identifier">tutorial</span>[<span class="ruby-string">&#39;name&#39;</span>])
        <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">material</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">compact!</span>

  <span class="ruby-comment"># Extract EDAM terms from all materials</span>
  <span class="ruby-identifier">edam_terms</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">material</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;edam_ontology&#39;</span>, []).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">term</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;DefinedTerm&#39;</span>,
        <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-node">&quot;http://edamontology.org/#{term}&quot;</span>,
        <span class="ruby-value">inDefinedTermSet:</span> <span class="ruby-string">&#39;http://edamontology.org&#39;</span>,
        <span class="ruby-value">termCode:</span> <span class="ruby-identifier">term</span>,
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">learning_objectives</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">material</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;objectives&#39;</span>, [])
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>

  <span class="ruby-comment"># TODO: add topic edam terms too? Not sure.</span>
  <span class="ruby-identifier">parts</span> = []
  <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">mat</span> = <span class="ruby-identifier">generate_material_jsonld</span>(<span class="ruby-identifier">material</span>, <span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;data&#39;</span>][<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]], <span class="ruby-identifier">site</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">mat</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">mat</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">mat</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;program&#39;</span>]
    <span class="ruby-identifier">syllab</span> = <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;program&#39;</span>].<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>[<span class="ruby-string">&#39;section&#39;</span>].<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Syllabus&#39;</span>,
        <span class="ruby-value">name:</span> <span class="ruby-identifier">section</span>[<span class="ruby-string">&#39;section&#39;</span>],
        <span class="ruby-value">description:</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;description&#39;</span>, <span class="ruby-keyword">nil</span>),
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = {
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;https://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Course&#39;</span>,
    <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{page[&#39;url&#39;]}&quot;</span>,
    <span class="ruby-value">name:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;title&#39;</span>],
    <span class="ruby-value">keywords:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> [],
    <span class="ruby-value">description:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;description&#39;</span>],

    <span class="ruby-value">about:</span> <span class="ruby-identifier">edam_terms</span>, <span class="ruby-comment"># TeSS, &quot;scientific topics&quot;.</span>
    <span class="ruby-value">audience:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;audience&#39;</span>], <span class="ruby-comment"># TeSS: target audience</span>
    <span class="ruby-comment"># If &#39;online&#39; is present in the mode, the course is online.</span>
    <span class="ruby-comment"># Will fail on &quot;this is NOT an online course&quot;</span>
    <span class="ruby-comment"># Acceptable.</span>
    <span class="ruby-value">courseMode:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;mode&#39;</span>],
    <span class="ruby-value">startDate:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;date_start&#39;</span>],
    <span class="ruby-value">endDate:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;date_end&#39;</span>],
    <span class="ruby-value">organizer:</span> <span class="ruby-identifier">organisers</span>, <span class="ruby-comment"># TeSS only, US spelling, non-standard</span>

    <span class="ruby-value">location:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>], <span class="ruby-comment"># TODO, TeSS location</span>
    <span class="ruby-value">teaches:</span> <span class="ruby-identifier">learning_objectives</span>, <span class="ruby-comment"># TeSS, &quot;learning objectives&quot;</span>
    <span class="ruby-comment"># timeRequired: &#39;P1D&#39;, # TeSS, &quot;duration&quot;, TODO: calculate from start/end date, not implemented in scraper currently.</span>

    <span class="ruby-value">availableLanguage:</span> [<span class="ruby-string">&#39;en&#39;</span>], <span class="ruby-comment"># TODO: support other languages</span>
    <span class="ruby-value">inLanguage:</span> [<span class="ruby-string">&#39;en&#39;</span>], <span class="ruby-comment"># TODO: support other languages</span>
    <span class="ruby-comment"># courseCode</span>
    <span class="ruby-comment"># coursePrerequisites</span>
    <span class="ruby-comment"># educationalCredentialAwarded</span>
    <span class="ruby-comment"># financialAidEligible</span>
    <span class="ruby-comment"># hasCourseInstance</span>
    <span class="ruby-comment"># numberOfCredits</span>
    <span class="ruby-comment"># occupationalCredentialAwarded</span>
    <span class="ruby-comment"># syllabusSections</span>
    <span class="ruby-comment"># totalHistoricalEnrollment</span>

    <span class="ruby-comment"># assesses</span>
    <span class="ruby-comment"># competencyRequired</span>
    <span class="ruby-comment"># educationalAlignment</span>
    <span class="ruby-comment"># educationalLevel</span>
    <span class="ruby-comment"># educationalUse</span>
    <span class="ruby-comment"># learningResourceType</span>
    <span class="ruby-comment"># teaches</span>

    <span class="ruby-value">funder:</span> <span class="ruby-identifier">funders</span>, <span class="ruby-comment"># Org or person</span>
    <span class="ruby-value">funding:</span> <span class="ruby-identifier">funding</span>, <span class="ruby-comment"># Grant</span>
    <span class="ruby-value">publisher:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-value">provider:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-value">syllabusSections:</span> <span class="ruby-identifier">syllab</span>,
    <span class="ruby-comment"># Session materials</span>
    <span class="ruby-comment"># TODO: not currently parsed by TeSS, google just complains about it, so we&#39;re leaving it out.</span>
    <span class="ruby-comment"># hasPart: parts,</span>
  }

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dateModified&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;datePublished&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">PublicationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dateModified&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;path&#39;</span>])
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;datePublished&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">PublicationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;path&#39;</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cover&#39;</span>]
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;image&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cover&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^http/</span>
                      [<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cover&#39;</span>]]
                    <span class="ruby-keyword">else</span>
                      [<span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{page[&#39;cover&#39;]}&quot;</span>]
                    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># We CANNOT guarantee A11Y</span>
  <span class="ruby-comment"># data.update(A11Y)</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cost&#39;</span>] <span class="ruby-keyword">and</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cost&#39;</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;free&#39;</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;isAccessibleForFree&#39;</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">offer</span> = {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Offer&#39;</span>,
      <span class="ruby-value">price:</span> <span class="ruby-value">0</span>,
      <span class="ruby-value">priceCurrency:</span> <span class="ruby-string">&#39;EUR&#39;</span>,
      <span class="ruby-value">category:</span> <span class="ruby-string">&#39;Free&#39;</span>,
      <span class="ruby-value">isAccessibleForFree:</span> <span class="ruby-keyword">true</span>,
    }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cost&#39;</span>]
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;isAccessibleForFree&#39;</span>] = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">offer</span> = {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Offer&#39;</span>,
      <span class="ruby-value">price:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cost&#39;</span>].<span class="ruby-identifier">split</span>[<span class="ruby-value">0</span>],
      <span class="ruby-value">priceCurrency:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cost&#39;</span>].<span class="ruby-identifier">split</span>[<span class="ruby-value">1</span>],
      <span class="ruby-value">isAccessibleForFree:</span> <span class="ruby-keyword">false</span>,
      <span class="ruby-value">category:</span> <span class="ruby-string">&#39;Paid&#39;</span>,
      <span class="ruby-comment"># TODO: this can be more advanced but we need to collect start/end times, and timezone.</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># TODO: this is wrong in a whole host of scenarios like incl weekends.</span>
  <span class="ruby-identifier">course_days</span> = (<span class="ruby-identifier">page</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;date_end&#39;</span>, <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;date_start&#39;</span>]) <span class="ruby-operator">-</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;date_start&#39;</span>]).<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">course_days</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">course_days</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;hasCourseInstance&#39;</span>] = [
    {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CourseInstance&#39;</span>,
      <span class="ruby-value">courseMode:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;mode&#39;</span>],
      <span class="ruby-comment"># courseWorkload: &quot;A daily course running from #{page[&#39;date_start&#39;]} to #{page[&#39;date_end&#39;]}&quot;,</span>
      <span class="ruby-value">offers:</span> <span class="ruby-identifier">offer</span>,
      <span class="ruby-value">instructor:</span> <span class="ruby-identifier">instructors</span>,
      <span class="ruby-value">isAccessibleForFree:</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;isAccessibleForFree&#39;</span>],
      <span class="ruby-value">courseSchedule:</span> {
        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Schedule&#39;</span>,
        <span class="ruby-value">startDate:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;date_start&#39;</span>],
        <span class="ruby-value">endDate:</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;date_end&#39;</span>, <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;date_start&#39;</span>]),
        <span class="ruby-value">repeatCount:</span> <span class="ruby-identifier">course_days</span>,
        <span class="ruby-value">repeatFrequency:</span> <span class="ruby-string">&#39;daily&#39;</span>, <span class="ruby-comment"># Contrary to schema.org spec, this is what Google wants.</span>
      },
      <span class="ruby-value">courseWorkload:</span> <span class="ruby-node">&quot;P#{course_days}D&quot;</span>,
    }
  ]

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;offers&#39;</span>] = [<span class="ruby-identifier">offer</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;location&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;location&#39;</span>] = {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Place&#39;</span>,
      <span class="ruby-value">name:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>][<span class="ruby-string">&#39;name&#39;</span>],
      <span class="ruby-value">address:</span> {
        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;PostalAddress&#39;</span>,
        <span class="ruby-value">streetAddress:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>].<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;address&#39;</span>, <span class="ruby-keyword">nil</span>),
        <span class="ruby-value">addressLocality:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>].<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;city&#39;</span>, <span class="ruby-keyword">nil</span>),
        <span class="ruby-value">addressRegion:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>].<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;region&#39;</span>, <span class="ruby-keyword">nil</span>),
        <span class="ruby-value">postalCode:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>].<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;postcode&#39;</span>, <span class="ruby-keyword">nil</span>),
        <span class="ruby-value">addressCountry:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;location&#39;</span>].<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;country&#39;</span>, <span class="ruby-keyword">nil</span>)
      }
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_funder_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_funder_jsonld</span><span
              class="method-args">(id, contributor, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="generate_funder_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_funder_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
  {
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;https://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Organization&#39;</span>,
    <span class="ruby-value">&#39;http://purl.org/dc/terms/conformsTo&#39;:</span> {
      <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-string">&#39;https://bioschemas.org/profiles/Organization/0.3-DRAFT&#39;</span>,
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>
    },
    <span class="ruby-value">name:</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_name</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">id</span>),
    <span class="ruby-value">description:</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;funding_statement&#39;</span>, <span class="ruby-string">&#39;An organization supporting the Galaxy Training Network&#39;</span>),
    <span class="ruby-value">url:</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;url&#39;</span>, <span class="ruby-node">&quot;https://training.galaxyproject.org/training-material/hall-of-fame/#{id}/&quot;</span>),
    <span class="ruby-value">logo:</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;avatar&#39;</span>, <span class="ruby-node">&quot;https://github.com/#{id}.png&quot;</span>),
  }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_grant_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_grant_jsonld</span><span
              class="method-args">(id, contributor, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="generate_grant_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_grant_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">organization</span> = {
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;https://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Grant&#39;</span>,
    <span class="ruby-value">identifier:</span> <span class="ruby-identifier">contributor</span>[<span class="ruby-string">&#39;funding_id&#39;</span>],
    <span class="ruby-value">url:</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_funding_url</span>(<span class="ruby-identifier">contributor</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">contributor</span>[<span class="ruby-string">&#39;url&#39;</span>],
    <span class="ruby-value">funder:</span> <span class="ruby-identifier">generate_funder_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
  }

  <span class="ruby-identifier">organization</span>[<span class="ruby-string">&#39;startDate&#39;</span>] = <span class="ruby-identifier">contributor</span>[<span class="ruby-string">&#39;start_date&#39;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;start_date&#39;</span>)
  <span class="ruby-identifier">organization</span>[<span class="ruby-string">&#39;endDate&#39;</span>] = <span class="ruby-identifier">contributor</span>[<span class="ruby-string">&#39;end_date&#39;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;end_date&#39;</span>)

  <span class="ruby-identifier">organization</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_learning_pathway_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_learning_pathway_jsonld</span><span
              class="method-args">(page, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Generate the JSON-LD metadata for a learning pathway Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>page</code>
<dd>
<p>The page object.</p>
</dd><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> site object.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The JSON-LD metadata.</p>
</dd></dl>

          <div class="method-source-code" id="generate_learning_pathway_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 480</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_learning_pathway_jsonld</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span> = []
  <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;pathway&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">section</span>.<span class="ruby-identifier">key?</span> <span class="ruby-string">&#39;tutorials&#39;</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">section</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tutorial</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">tutorial</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;custom&#39;</span>)
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">material</span> = <span class="ruby-constant">TopicFilter</span>.<span class="ruby-identifier">fetch_tutorial_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tutorial</span>[<span class="ruby-string">&#39;topic&#39;</span>], <span class="ruby-identifier">tutorial</span>[<span class="ruby-string">&#39;name&#39;</span>])
      <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">material</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">compact!</span>

  <span class="ruby-comment"># Extract EDAM terms from all materials</span>
  <span class="ruby-identifier">edam_terms</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">material</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;edam_ontology&#39;</span>, []).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">term</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;DefinedTerm&#39;</span>,
        <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-node">&quot;http://edamontology.org/#{term}&quot;</span>,
        <span class="ruby-value">inDefinedTermSet:</span> <span class="ruby-string">&#39;http://edamontology.org&#39;</span>,
        <span class="ruby-value">termCode:</span> <span class="ruby-identifier">term</span>,
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">learning_objectives</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">material</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;objectives&#39;</span>, [])
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>

  <span class="ruby-identifier">funders</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_funders</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">material</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">compact</span>

  <span class="ruby-identifier">funding</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_grants</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">material</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">compact</span>

  <span class="ruby-comment"># TODO: add topic edam terms too? Not sure.</span>
  <span class="ruby-identifier">parts</span> = []
  <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">material</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">mat</span> = <span class="ruby-identifier">generate_material_jsonld</span>(<span class="ruby-identifier">material</span>, <span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;data&#39;</span>][<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]], <span class="ruby-identifier">site</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">mat</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">mat</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">mat</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">syllab</span> = <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;pathway&#39;</span>].<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>[<span class="ruby-string">&#39;section&#39;</span>].<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Syllabus&#39;</span>,
      <span class="ruby-value">name:</span> <span class="ruby-identifier">section</span>[<span class="ruby-string">&#39;section&#39;</span>],
      <span class="ruby-value">description:</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;description&#39;</span>, <span class="ruby-keyword">nil</span>),
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = {
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;https://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Course&#39;</span>,
    <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{page[&#39;url&#39;]}&quot;</span>,
    <span class="ruby-value">name:</span> <span class="ruby-node">&quot;Learning Pathway #{page[&#39;title&#39;]}&quot;</span>,
    <span class="ruby-value">keywords:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> [],
    <span class="ruby-value">description:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;description&#39;</span>],
    <span class="ruby-value">about:</span> <span class="ruby-identifier">edam_terms</span>, <span class="ruby-comment"># TeSS, &quot;scientific topics&quot;.</span>
    <span class="ruby-value">audience:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;audience&#39;</span>], <span class="ruby-comment"># TeSS: target audience</span>
    <span class="ruby-value">teaches:</span> <span class="ruby-identifier">learning_objectives</span>, <span class="ruby-comment"># TeSS, &quot;learning objectives&quot;</span>
    <span class="ruby-value">availableLanguage:</span> [<span class="ruby-string">&#39;en&#39;</span>], <span class="ruby-comment"># TODO: support other languages</span>
    <span class="ruby-value">inLanguage:</span> [<span class="ruby-string">&#39;en&#39;</span>], <span class="ruby-comment"># TODO: support other languages</span>
    <span class="ruby-comment"># courseCode</span>
    <span class="ruby-comment"># coursePrerequisites</span>
    <span class="ruby-comment"># educationalCredentialAwarded</span>
    <span class="ruby-comment"># financialAidEligible</span>
    <span class="ruby-comment"># hasCourseInstance</span>
    <span class="ruby-comment"># numberOfCredits</span>
    <span class="ruby-comment"># occupationalCredentialAwarded</span>
    <span class="ruby-comment"># syllabusSections</span>
    <span class="ruby-comment"># totalHistoricalEnrollment</span>

    <span class="ruby-comment"># assesses</span>
    <span class="ruby-comment"># competencyRequired</span>
    <span class="ruby-comment"># educationalAlignment</span>
    <span class="ruby-comment"># educationalLevel</span>
    <span class="ruby-comment"># educationalUse</span>
    <span class="ruby-comment"># learningResourceType</span>
    <span class="ruby-comment"># teaches</span>

    <span class="ruby-value">funder:</span> <span class="ruby-identifier">funders</span>, <span class="ruby-comment"># Org or person</span>
    <span class="ruby-value">funding:</span> <span class="ruby-identifier">funding</span>, <span class="ruby-comment"># Grant</span>
    <span class="ruby-value">publisher:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-value">provider:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-value">syllabusSections:</span> <span class="ruby-identifier">syllab</span>,
    <span class="ruby-comment"># Session materials</span>
    <span class="ruby-comment"># TODO: not currently parsed by TeSS, google just complains about it, so we&#39;re leaving it out.</span>
    <span class="ruby-comment"># hasPart: parts,</span>
  }

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dateModified&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;datePublished&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">PublicationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dateModified&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;path&#39;</span>])
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;datePublished&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">PublicationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;path&#39;</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cover&#39;</span>]
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;image&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cover&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^http/</span>
                      [<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;cover&#39;</span>]]
                    <span class="ruby-keyword">else</span>
                      [<span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{page[&#39;cover&#39;]}&quot;</span>]
                    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># We CANNOT guarantee A11Y</span>
  <span class="ruby-comment"># data.update(A11Y)</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;isAccessibleForFree&#39;</span>] = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">offer</span> = {
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Offer&#39;</span>,
    <span class="ruby-value">price:</span> <span class="ruby-value">0</span>,
    <span class="ruby-value">priceCurrency:</span> <span class="ruby-string">&#39;EUR&#39;</span>,
    <span class="ruby-value">category:</span> <span class="ruby-string">&#39;Free&#39;</span>,
    <span class="ruby-value">isAccessibleForFree:</span> <span class="ruby-keyword">true</span>,
  }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;offers&#39;</span>] = [<span class="ruby-identifier">offer</span>]

  <span class="ruby-comment"># TODO: this is basically just wrong.</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;hasCourseInstance&#39;</span>] = [
    {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CourseInstance&#39;</span>,
      <span class="ruby-value">courseMode:</span> <span class="ruby-string">&#39;online&#39;</span>,
      <span class="ruby-value">offers:</span> <span class="ruby-identifier">offer</span>,
      <span class="ruby-value">isAccessibleForFree:</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;isAccessibleForFree&#39;</span>],
    }
  ]

  <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_material_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_material_jsonld</span><span
              class="method-args">(material, topic, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Convert a material to JSON-LD. Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>material</code>
<dd>
<p>The material object.</p>
</dd><dt><code>topic</code>
<dd>
<p>The topic object.</p>
</dd><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> site object.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The JSON-LD metadata.</p>
</dd></dl>

          <div class="method-source-code" id="generate_material_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 646</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_material_jsonld</span>(<span class="ruby-identifier">material</span>, <span class="ruby-identifier">topic</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">langCodeMap</span> = {
    <span class="ruby-string">&quot;en&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;English&#39;</span>,
    <span class="ruby-string">&quot;es&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Español&#39;</span>,
    <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Français&#39;</span>,
  }

  <span class="ruby-identifier">eduLevel</span> = {
    <span class="ruby-string">&#39;Introductory&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Beginner&#39;</span>,
    <span class="ruby-string">&#39;Intermediate&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Intermediate&#39;</span>,
    <span class="ruby-string">&#39;Advanced&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Advanced&#39;</span>
  }
  <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;{}&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">topic</span>

  <span class="ruby-identifier">topic_desc</span> = {
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>,
    <span class="ruby-value">name:</span> (<span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>,
    <span class="ruby-value">description:</span> (<span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;summary&#39;</span>]).<span class="ruby-identifier">to_s</span>,
    <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}/topics/#{topic[&#39;name&#39;]}/&quot;</span>
  }

  <span class="ruby-comment"># aggregate everything</span>
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-comment"># Properties from Course</span>
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;http://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;LearningResource&#39;</span>,

    <span class="ruby-comment"># Required for BioSchemas</span>
    <span class="ruby-value">&#39;http://purl.org/dc/terms/conformsTo&#39;:</span> {
      <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-string">&#39;https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE&#39;</span>,
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>
    },

    <span class="ruby-comment"># Properties from CreativeWork</span>
    <span class="ruby-comment"># &quot;about&quot; described below</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># &quot;accountablePerson&quot;:,</span>
    <span class="ruby-comment"># &quot;aggregateRating&quot;:,</span>
    <span class="ruby-comment"># &quot;alternativeHeadline&quot;:,</span>
    <span class="ruby-comment"># &quot;associatedMedia&quot;:,</span>
    <span class="ruby-value">audience:</span> {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;EducationalAudience&#39;</span>,
      <span class="ruby-value">educationalRole:</span> <span class="ruby-constant">EDU_ROLES</span>[<span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;type&#39;</span>]]
    },
    <span class="ruby-comment"># &quot;audio&quot;:,</span>
    <span class="ruby-comment"># &quot;award&quot;:,</span>
    <span class="ruby-comment"># &quot;author&quot; described below</span>
    <span class="ruby-comment"># &quot;character&quot;:,</span>
    <span class="ruby-value">citation:</span> [
      {
        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>,
        <span class="ruby-value">name:</span> <span class="ruby-string">&#39;Galaxy Training: A Powerful Framework for Teaching!&#39;</span>,
        <span class="ruby-value">url:</span> <span class="ruby-string">&#39;https://doi.org/10.1371/journal.pcbi.1010752&#39;</span>
      },
      {
        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>,
        <span class="ruby-value">name:</span> <span class="ruby-string">&#39;Community-Driven Data Analysis Training for Biology&#39;</span>,
        <span class="ruby-value">url:</span> <span class="ruby-string">&#39;https://doi.org/10.1016/j.cels.2018.05.012&#39;</span>
      }
    ],
    <span class="ruby-comment"># &quot;comment&quot;:,</span>
    <span class="ruby-comment"># &quot;commentCount&quot;:,</span>
    <span class="ruby-comment"># &quot;contentLocation&quot;:,</span>
    <span class="ruby-comment"># &quot;contentRating&quot;:,</span>
    <span class="ruby-comment"># &quot;contentReferenceTime&quot;:,</span>
    <span class="ruby-comment"># &quot;contributor&quot; described below</span>
    <span class="ruby-comment"># copyrightHolder: GTN,</span>
    <span class="ruby-comment"># copyrightNotice: m</span>
    <span class="ruby-comment"># &quot;copyrightYear&quot;:,</span>
    <span class="ruby-comment"># &quot;correction&quot;:,</span>
    <span class="ruby-comment"># &quot;creator&quot;:,</span>
    <span class="ruby-comment"># &quot;dateCreated&quot;:,</span>
    <span class="ruby-comment"># &quot;datePublished&quot;:,</span>
    <span class="ruby-value">discussionUrl:</span> <span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;gitter_url&#39;</span>],
    <span class="ruby-comment"># &quot;editor&quot;:,</span>
    <span class="ruby-comment"># &quot;educationalAlignment&quot;:,</span>
    <span class="ruby-comment"># &quot;educationalUse&quot;:,</span>
    <span class="ruby-comment"># &quot;encoding&quot;:,</span>
    <span class="ruby-comment"># &quot;encodingFormat&quot;:,</span>
    <span class="ruby-comment"># &quot;exampleOfWork&quot;:,</span>
    <span class="ruby-comment"># &quot;expires&quot;:,</span>
    <span class="ruby-comment"># &quot;funder&quot;: funding,</span>
    <span class="ruby-comment"># &quot;genre&quot;:,</span>
    <span class="ruby-comment"># &quot;hasPart&quot; described below</span>
    <span class="ruby-value">headline:</span> (<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>,
    <span class="ruby-comment"># &quot;interactionStatistic&quot;:,</span>
    <span class="ruby-value">interactivityType:</span> <span class="ruby-string">&#39;mixed&#39;</span>,
    <span class="ruby-value">isAccessibleForFree:</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-comment"># &quot;isBasedOn&quot;:,</span>
    <span class="ruby-value">isFamilyFriendly:</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-comment"># &quot;isPartOf&quot; described below</span>
    <span class="ruby-comment"># &quot;keywords&quot;: described below</span>
    <span class="ruby-comment"># &quot;learningResourceType&quot; described below</span>
    <span class="ruby-value">license:</span> <span class="ruby-string">&#39;https://spdx.org/licenses/CC-BY-4.0.html&#39;</span>,
    <span class="ruby-comment"># &quot;locationCreated&quot;:,</span>
    <span class="ruby-comment"># &quot;mainEntity&quot;:,</span>
    <span class="ruby-comment"># &quot;material&quot;:,</span>
    <span class="ruby-comment"># &quot;mentions&quot; described below</span>
    <span class="ruby-comment"># &quot;offers&quot;:,</span>
    <span class="ruby-comment"># &quot;position&quot;:,</span>
    <span class="ruby-value">producer:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-value">provider:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-comment"># &quot;publication&quot;:,</span>
    <span class="ruby-comment"># &quot;publisher&quot;:,</span>
    <span class="ruby-comment"># &quot;publisherImprint&quot;:,</span>
    <span class="ruby-comment"># &quot;publishingPrinciples&quot;:,</span>
    <span class="ruby-comment"># &quot;recordedAt&quot;:,</span>
    <span class="ruby-comment"># &quot;releasedEvent&quot;:,</span>
    <span class="ruby-comment"># &quot;review&quot;:,</span>
    <span class="ruby-comment"># &quot;schemaVersion&quot;:,</span>
    <span class="ruby-comment"># &quot;sdDatePublished&quot;:,</span>
    <span class="ruby-comment"># &quot;sdLicense&quot;:,</span>
    <span class="ruby-comment"># &quot;sdPublisher&quot;:,</span>
    <span class="ruby-value">sourceOrganization:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-comment"># &quot;spatialCoverage&quot;:,</span>
    <span class="ruby-comment"># &quot;sponsor&quot;:,</span>
    <span class="ruby-comment"># &quot;temporalCoverage&quot;:,</span>
    <span class="ruby-comment"># &quot;text&quot;:,</span>
    <span class="ruby-comment"># &quot;thumbnailUrl&quot;:,</span>
    <span class="ruby-comment"># &quot;timeRequired&quot; described below</span>
    <span class="ruby-comment"># &quot;translationOfWork&quot;:,</span>
    <span class="ruby-comment"># &quot;translator&quot;: Google Translate???,</span>
    <span class="ruby-comment"># &quot;typicalAgeRange&quot;:,</span>
    <span class="ruby-comment"># &quot;version&quot;:,</span>
    <span class="ruby-comment"># &quot;video&quot;:,</span>
    <span class="ruby-comment"># &quot;workExample&quot;:,</span>
    <span class="ruby-comment"># &quot;workTranslation&quot;:,</span>

    <span class="ruby-comment"># Properties from Thing</span>
    <span class="ruby-comment"># &quot;additionalType&quot;:,</span>
    <span class="ruby-comment"># &quot;alternateName&quot;:,</span>
    <span class="ruby-comment"># &quot;description&quot; described below</span>
    <span class="ruby-comment"># &quot;disambiguatingDescription&quot;:,</span>
    <span class="ruby-comment"># &quot;image&quot;:,</span>
    <span class="ruby-comment"># &quot;mainEntityOfPage&quot;:,</span>
    <span class="ruby-comment"># &quot;name&quot; described below</span>
    <span class="ruby-comment"># &quot;potentialAction&quot;:,</span>
    <span class="ruby-comment"># &quot;sameAs&quot;:,</span>
    <span class="ruby-comment"># &quot;subjectOf&quot;:,</span>
    <span class="ruby-comment"># &quot;url&quot; described below</span>
    <span class="ruby-value">workTranslation:</span> [],
    <span class="ruby-value">creativeWorkStatus:</span> <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;draft&#39;</span>] <span class="ruby-operator">?</span> <span class="ruby-string">&#39;Draft&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;Active&#39;</span>,
  }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;pub_date&#39;</span>)
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dateModified&#39;</span>] = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;mod_date&#39;</span>]
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;datePublished&#39;</span>] = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;pub_date&#39;</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dateModified&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">material</span>.<span class="ruby-identifier">path</span>)
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;datePublished&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">PublicationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">material</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dateModified&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;path&#39;</span>])
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;datePublished&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">PublicationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;path&#39;</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;copyright&#39;</span>)
    <span class="ruby-comment"># copyrightHolder: GTN,</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;copyrightNotice&#39;</span>] = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;copyright&#39;</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># I&#39;m not sure this is accurate.</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;copyrightHolder&#39;</span>] = <span class="ruby-constant">GTN</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">funders</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_funders</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">material</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">grants</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_grants</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">material</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;funder&#39;</span>] = <span class="ruby-identifier">funders</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;funding&#39;</span>] = <span class="ruby-identifier">grants</span>

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;identifier&#39;</span>] = <span class="ruby-node">&quot;https://gxy.io/GTN:#{material[&#39;short_id&#39;]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;short_id&#39;</span>)

  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">update</span>(<span class="ruby-constant">A11Y</span>)

  <span class="ruby-identifier">actual_material</span> = <span class="ruby-constant">TopicFilter</span>.<span class="ruby-identifier">fetch_tutorial_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;topic_name&#39;</span>], <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>])

  <span class="ruby-comment"># info depending if tutorial, hands-on or slide level</span>
  <span class="ruby-comment"># parts = []</span>
  <span class="ruby-comment"># data[&#39;hasPart&#39;] = parts</span>

  <span class="ruby-identifier">mentions</span> = []
  <span class="ruby-identifier">description</span> = []

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;isPartOf&#39;</span>] = <span class="ruby-identifier">topic_desc</span>

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;abstract&#39;</span>] = <span class="ruby-identifier">material</span>
    .<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;content&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
    .<span class="ruby-identifier">strip</span>
    .<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)
    .<span class="ruby-identifier">first</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;abstract&#39;</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;abstract&#39;</span>] = <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;abstract&#39;</span>]
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\{\{\s*site.baseurl\s*\}\}/</span>, <span class="ruby-identifier">url_prefix</span>(<span class="ruby-identifier">site</span>))
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\[{{\s*site.url\s*}}/</span>, <span class="ruby-string">&#39;[&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">url_prefix</span>(<span class="ruby-identifier">site</span>))
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/{% link (topics[^%]*).md %}/</span>, <span class="ruby-identifier">url_prefix</span>(<span class="ruby-identifier">site</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;\1.html&#39;</span>)
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/{% link (topics[^%]*).html %}/</span>, <span class="ruby-identifier">url_prefix</span>(<span class="ruby-identifier">site</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;\1.html&#39;</span>)
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\s*\(?{%\s*cite [^}]+\s*%}\)?/</span>, <span class="ruby-string">&#39;&#39;</span>)
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;{{ site.github_repository }}&#39;</span>, <span class="ruby-identifier">safe_site_config</span>(<span class="ruby-identifier">site</span>, <span class="ruby-string">&#39;github_repository&#39;</span>, <span class="ruby-string">&#39;https://example.com&#39;</span>))
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/{% snippet ([^%]*) %}/</span>, <span class="ruby-string">&#39;&#39;</span>)
      .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/{% include ([^%]*) %}/</span>, <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">description</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;## Abstract\n\n#{data[&#39;abstract&#39;]}\n\n&quot;</span>)

  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial.md&#39;</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;slides.html&#39;</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial.md&#39;</span>
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;learningResourceType&#39;</span>] = <span class="ruby-string">&#39;e-learning&#39;</span>
      <span class="ruby-identifier">description</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&quot;## About This Material\n\nThis is a Hands-on Tutorial from the GTN which is usable either for individual self-study, or as a teaching material in a classroom.\n\n&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;learningResourceType&#39;</span>] = <span class="ruby-string">&#39;slides&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;name&#39;</span>] = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;title&#39;</span>]
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;url&#39;</span>] = <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{material[&#39;url&#39;]}&quot;</span>

    <span class="ruby-comment"># Requires https://github.com/galaxyproject/training-material/pull/4271</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;version&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_modification_count</span>(<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;path&#39;</span>])

    <span class="ruby-comment"># Time required</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;time_estimation&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;time_estimation&#39;</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;timeRequired&#39;</span>] = <span class="ruby-node">&quot;PT#{material[&#39;time_estimation&#39;].upcase}&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Description with questions, objectives and keypoints</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;questions&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;questions&#39;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;questions&#39;</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
      <span class="ruby-identifier">questions</span> = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;questions&#39;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n - &quot;</span>)
      <span class="ruby-identifier">description</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;## Questions this #{material[&#39;type&#39;]} will address\n\n - #{questions}\n\n&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;objectives&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;objectives&#39;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;objectives&#39;</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
      <span class="ruby-identifier">objectives</span> = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;objectives&#39;</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;- #{x}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
      <span class="ruby-identifier">description</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;## Learning Objectives\n\n#{objectives}\n\n&quot;</span>)
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;teaches&#39;</span>] = <span class="ruby-identifier">objectives</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;keypoints&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;keypoints&#39;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;keypoints&#39;</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
      <span class="ruby-identifier">keypoints</span> = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;keypoints&#39;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n - &quot;</span>)
      <span class="ruby-identifier">description</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;## Key Points\n\n - #{keypoints}\n\n&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Keywords</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;keywords&#39;</span>] = [<span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;title&#39;</span>]] <span class="ruby-operator">+</span> (<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> [])
    <span class="ruby-comment"># Zenodo links</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Mentions are &#39;external resources&#39; in TeSS.</span>
  <span class="ruby-comment"># This could be expanded with</span>
  <span class="ruby-comment"># - supported servers</span>
  <span class="ruby-comment"># - tools and resources used (e.g. Galaxy) or tools linked to the TS.</span>
  <span class="ruby-comment"># - slides (if tutorial) and tutorial (if slides)</span>
  <span class="ruby-comment"># - other materials in the same topic?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">actual_material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;workflows&#39;</span>)
    <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                    <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{material[&#39;dir&#39;]}workflows/&quot;</span>,
                    <span class="ruby-value">name:</span> <span class="ruby-string">&quot;Associated Workflows&quot;</span>
                  })
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Notebooks</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">actual_material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;notebook&#39;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">actual_material</span>[<span class="ruby-string">&#39;notebook&#39;</span>][<span class="ruby-string">&#39;language&#39;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;r&#39;</span>
      <span class="ruby-comment"># Python, Bash, SQL (all via jupyter)</span>
      <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{material[&#39;dir&#39;]}#{material[&#39;topic_name&#39;]}-#{material[&#39;tutorial_name&#39;]}.ipynb&quot;</span>
      <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                      <span class="ruby-value">url:</span> <span class="ruby-identifier">url</span>,
                      <span class="ruby-value">name:</span> <span class="ruby-string">&quot;Jupyter Notebook (with Solutions)&quot;</span>
                    })
      <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                      <span class="ruby-value">url:</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\.ipynb$/</span>, <span class="ruby-string">&#39;-course.ipynb&#39;</span>),
                      <span class="ruby-value">name:</span> <span class="ruby-string">&quot;Jupyter Notebook (without Solutions)&quot;</span>
                    })
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">actual_material</span>[<span class="ruby-string">&#39;notebook&#39;</span>][<span class="ruby-string">&#39;language&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;r&#39;</span> <span class="ruby-comment"># Actual R</span>
      <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{material[&#39;dir&#39;]}#{material[&#39;topic_name&#39;]}-#{material[&#39;tutorial_name&#39;]}.Rmd&quot;</span>
      <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                      <span class="ruby-value">url:</span> <span class="ruby-identifier">url</span>,
                      <span class="ruby-value">name:</span> <span class="ruby-string">&quot;Quarto/RMarkdown Notebook&quot;</span>
                    })
      <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                      <span class="ruby-value">url:</span> <span class="ruby-string">&quot;https://bio.tools/tool/rstudio&quot;</span>,
                      <span class="ruby-value">name:</span> <span class="ruby-string">&quot;RStudio&quot;</span>
                    })
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Tools</span>
  <span class="ruby-identifier">uses_tools</span> = <span class="ruby-keyword">false</span>
  (<span class="ruby-identifier">actual_material</span>[<span class="ruby-string">&#39;tools&#39;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tool</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;tool-meta&#39;</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">toolmeta</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;tool-meta&#39;</span>][<span class="ruby-identifier">tool</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">toolmeta</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">toolmeta</span>[<span class="ruby-string">&#39;bio.tools&#39;</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
      <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                      <span class="ruby-value">url:</span> <span class="ruby-node">&quot;https://bio.tools/tool/#{toolmeta[&#39;bio.tools&#39;]}&quot;</span>,
                      <span class="ruby-value">name:</span> <span class="ruby-identifier">toolmeta</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;bio.tools_name&#39;</span>, <span class="ruby-identifier">toolmeta</span>[<span class="ruby-string">&#39;name&#39;</span>])
                    })
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">uses_tools</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">uses_tools</span>
    <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                    <span class="ruby-value">url:</span> <span class="ruby-string">&quot;https://bio.tools/tool/galaxy&quot;</span>,
                    <span class="ruby-value">name:</span> <span class="ruby-string">&quot;Galaxy&quot;</span>
                  })
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Zenodo link out</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">actual_material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;zenodo_link&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">actual_material</span>[<span class="ruby-string">&#39;zenodo_link&#39;</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">actual_material</span>[<span class="ruby-string">&#39;zenodo_link&#39;</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
      <span class="ruby-identifier">mentions</span>.<span class="ruby-identifier">push</span>({
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Thing&#39;</span>,
                      <span class="ruby-value">url:</span> (<span class="ruby-identifier">actual_material</span>[<span class="ruby-string">&#39;zenodo_link&#39;</span>]).<span class="ruby-identifier">to_s</span>,
                      <span class="ruby-value">name:</span> <span class="ruby-string">&quot;Associated Training Datasets&quot;</span>
                    })
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">description</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">description</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">material</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;content&#39;</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>).<span class="ruby-identifier">first</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;description&#39;</span>] = <span class="ruby-identifier">description</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;inLanguage&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;lang&#39;</span>)
                         {
                           <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Language&#39;</span>,
                           <span class="ruby-value">name:</span> <span class="ruby-identifier">langCodeMap</span>[<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;lang&#39;</span>]],
                           <span class="ruby-value">alternateName:</span> <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;lang&#39;</span>]
                         }
                       <span class="ruby-keyword">else</span>
                         {
                           <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Language&#39;</span>,
                           <span class="ruby-value">name:</span> <span class="ruby-string">&#39;English&#39;</span>,
                           <span class="ruby-value">alternateName:</span> <span class="ruby-string">&#39;en&#39;</span>
                         }
                       <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Course requirements (material + topic)</span>
  <span class="ruby-identifier">reqs</span> = []
  <span class="ruby-identifier">reqs</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;requirements&#39;</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;requirements&#39;</span>)
  <span class="ruby-identifier">reqs</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;requirements&#39;</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;requirements&#39;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reqs</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">coursePrerequisites</span> = []
    <span class="ruby-identifier">reqs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;internal&#39;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;tutorials&#39;</span>)
          (<span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;tutorials&#39;</span>]).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tuto</span><span class="ruby-operator">|</span>
            (<span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;pages&#39;</span>]).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial.md&#39;</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;slides.html&#39;</span>)) <span class="ruby-operator">&amp;&amp;</span>
                 ((<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">tuto</span>))
                <span class="ruby-comment"># slides</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;slides.html&#39;</span>
                  <span class="ruby-identifier">coursePrerequisites</span>.<span class="ruby-identifier">push</span>(
                    {
                      <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;http://schema.org&#39;</span>,
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;LearningResource&#39;</span>,
                      <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}/topics/#{req[&#39;topic_name&#39;]}/&quot;</span> \
                           <span class="ruby-node">&quot;tutorials/#{tuto}/slides.html&quot;</span>,
                      <span class="ruby-value">name:</span> (<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>,
                      <span class="ruby-value">description:</span> <span class="ruby-node">&quot;Slides for &#39;#{page[&#39;title&#39;]}&#39; tutorial&quot;</span>,
                      <span class="ruby-value">learningResourceType:</span> <span class="ruby-string">&#39;slides&#39;</span>,
                      <span class="ruby-value">interactivityType:</span> <span class="ruby-string">&#39;expositive&#39;</span>,
                      <span class="ruby-value">provider:</span> <span class="ruby-constant">GTN</span>
                    }
                  )
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;hands_on_url&#39;</span>]
                    <span class="ruby-identifier">coursePrerequisites</span>.<span class="ruby-identifier">push</span>(
                      {
                        <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;http://schema.org&#39;</span>,
                        <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;LearningResource&#39;</span>,
                        <span class="ruby-value">url:</span> (<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;hands_on_url&#39;</span>]).<span class="ruby-identifier">to_s</span>,
                        <span class="ruby-value">learningResourceType:</span> <span class="ruby-string">&#39;e-learning&#39;</span>,
                        <span class="ruby-value">interactivityType:</span> <span class="ruby-string">&#39;expositive&#39;</span>,
                      }
                    )
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-comment"># hands-on</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial.md&#39;</span>
                  <span class="ruby-identifier">coursePrerequisites</span>.<span class="ruby-identifier">push</span>(
                    {
                      <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;http://schema.org&#39;</span>,
                      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;LearningResource&#39;</span>,
                      <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}/topics/#{req[&#39;topic_name&#39;]}/tutorials&quot;</span> \
                           <span class="ruby-node">&quot;/#{tuto}/tutorial.html&quot;</span>,
                      <span class="ruby-value">name:</span> (<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>,
                      <span class="ruby-value">description:</span> <span class="ruby-node">&quot;Hands-on for &#39;#{page[&#39;title&#39;]}&#39; tutorial&quot;</span>,
                      <span class="ruby-value">learningResourceType:</span> <span class="ruby-string">&#39;e-learning&#39;</span>,
                      <span class="ruby-value">interactivityType:</span> <span class="ruby-string">&#39;expositive&#39;</span>,
                      <span class="ruby-value">provider:</span> <span class="ruby-constant">GTN</span>
                    }
                  )
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">coursePrerequisites</span>.<span class="ruby-identifier">push</span>(
            {
              <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;http://schema.org&#39;</span>,
              <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;LearningResource&#39;</span>,
              <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}/topics/#{req[&#39;topic_name&#39;]}/&quot;</span>,
              <span class="ruby-value">name:</span> (<span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;data&#39;</span>][<span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]][<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>,
              <span class="ruby-value">description:</span> (<span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;data&#39;</span>][<span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]][<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>,
              <span class="ruby-value">provider:</span> <span class="ruby-constant">GTN</span>
            }
          )
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;external&#39;</span>
        <span class="ruby-identifier">coursePrerequisites</span>.<span class="ruby-identifier">push</span>({
                                   <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>,
                                   <span class="ruby-value">url:</span> (<span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;link&#39;</span>]).<span class="ruby-identifier">to_s</span>,
                                   <span class="ruby-value">name:</span> (<span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>
                                 })
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">coursePrerequisites</span>.<span class="ruby-identifier">push</span>((<span class="ruby-identifier">req</span>[<span class="ruby-string">&#39;title&#39;</span>]).<span class="ruby-identifier">to_s</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;competencyRequired&#39;</span>] = <span class="ruby-identifier">coursePrerequisites</span>.<span class="ruby-identifier">uniq</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Add contributors/authors</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;contributors&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;contributions&#39;</span>)
    <span class="ruby-identifier">authors</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_authors</span>(<span class="ruby-identifier">material</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">generate_person_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_contributor</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">x</span>), <span class="ruby-identifier">site</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;author&#39;</span>] = <span class="ruby-identifier">authors</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Add non-author contributors</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;contributions&#39;</span>)
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;contributor&#39;</span>] = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_non_authors</span>(<span class="ruby-identifier">material</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">generate_person_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>[<span class="ruby-string">&#39;data&#39;</span>][<span class="ruby-string">&#39;contributors&#39;</span>][<span class="ruby-identifier">x</span>], <span class="ruby-identifier">site</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">about</span> = []
  <span class="ruby-identifier">about</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">topic_desc</span>)
  <span class="ruby-identifier">edam_terms</span> = <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;edam_ontology&#39;</span>, []) <span class="ruby-operator">|</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;edam_ontology&#39;</span>, [])

  <span class="ruby-identifier">about</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">edam_terms</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">term</span><span class="ruby-operator">|</span>
    {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;DefinedTerm&#39;</span>,
      <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-node">&quot;http://edamontology.org/#{term}&quot;</span>,
      <span class="ruby-value">inDefinedTermSet:</span> <span class="ruby-string">&#39;http://edamontology.org&#39;</span>,
      <span class="ruby-value">termCode:</span> <span class="ruby-identifier">term</span>,
      <span class="ruby-comment"># &quot;name&quot;: ,</span>
      <span class="ruby-value">url:</span> <span class="ruby-string">&#39;https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&amp;conceptid=&#39;</span> \
           <span class="ruby-node">&quot;http%3A%2F%2Fedamontology.org%2F#{term}&quot;</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;about&#39;</span>] = <span class="ruby-identifier">about</span>

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;educationalLevel&#39;</span>] = <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;level&#39;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">eduLevel</span>[<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;level&#39;</span>]] <span class="ruby-operator">:</span> <span class="ruby-string">&#39;Beginner&#39;</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;mentions&#39;</span>] = <span class="ruby-identifier">mentions</span>

  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_news_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_news_jsonld</span><span
              class="method-args">(page, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Generate the JSON-LD metadata for a news article (blog) Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>page</code>
<dd>
<p>The page object.</p>
</dd><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> site object.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The JSON-LD metadata.</p>
</dd></dl>

          <div class="method-source-code" id="generate_news_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 229</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_news_jsonld</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">authors</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_authors</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">to_h</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">to_pfo_jsonld</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = {
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;https://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;BlogPosting&#39;</span>,
    <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}#{page[&#39;url&#39;]}&quot;</span>,
    <span class="ruby-value">name:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;title&#39;</span>],
    <span class="ruby-value">headline:</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">excerpt</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">100</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\n/</span>, <span class="ruby-string">&#39; &#39;</span>), <span class="ruby-comment"># TODO: remove html tags.</span>
    <span class="ruby-value">keywords:</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> [],
    <span class="ruby-value">description:</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">excerpt</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">100</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\n/</span>, <span class="ruby-string">&#39; &#39;</span>), <span class="ruby-comment"># TODO: remove html tags</span>
    <span class="ruby-value">articleBody:</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">content</span>, <span class="ruby-comment"># TODO: remove html tags</span>
    <span class="ruby-value">datePublished:</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">date</span>,
    <span class="ruby-value">dateModified:</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">path</span>),
    <span class="ruby-value">author:</span> <span class="ruby-identifier">authors</span>,
    <span class="ruby-value">publisher:</span> <span class="ruby-constant">GTN</span>,
    <span class="ruby-value">mainEntityOfPage:</span> {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;WebPage&#39;</span>,
      <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{page[&#39;url&#39;]}&quot;</span>
    },
    <span class="ruby-value">image:</span> {
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;ImageObject&#39;</span>,
      <span class="ruby-value">width:</span> <span class="ruby-value">60</span>,
      <span class="ruby-value">height:</span> <span class="ruby-value">60</span>,
      <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;baseurl&#39;]}/assets/images/GTN-60px.png&quot;</span>
    }
  }
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">update</span>(<span class="ruby-constant">A11Y</span>)

  <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_org_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_org_jsonld</span><span
              class="method-args">(id, contributor, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="generate_org_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 149</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_org_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">organization</span> = {
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;https://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Organization&#39;</span>,
    <span class="ruby-value">&#39;http://purl.org/dc/terms/conformsTo&#39;:</span> {
      <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-string">&#39;https://bioschemas.org/profiles/Organization/0.3-DRAFT&#39;</span>,
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>
    },
    <span class="ruby-value">id:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}/hall-of-fame/#{id}/&quot;</span>,
    <span class="ruby-value">name:</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_name</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">id</span>),
    <span class="ruby-value">description:</span> <span class="ruby-string">&#39;An organization supporting the Galaxy Training Network&#39;</span>,
  }

  <span class="ruby-identifier">organization</span>[<span class="ruby-string">&#39;url&#39;</span>] = <span class="ruby-identifier">contributor</span>[<span class="ruby-string">&#39;url&#39;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;url&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contributor</span>[<span class="ruby-string">&#39;url&#39;</span>]

  <span class="ruby-identifier">organization</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-generate_person_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_person_jsonld</span><span
              class="method-args">(id, contributor, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Generate the JSON-LD metadata for a person Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>id</code>
<dd>
<p>The id of the person.</p>
</dd><dt><code>contributor</code>
<dd>
<p>The contributor object from CONTRIBUTORS.yaml.</p>
</dd><dt><code>site</code>
<dd>
<p>The site object.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The JSON-LD metadata.</p>
</dd></dl>

<p>Example:</p>

<pre>generate_person_jsonld(&quot;hexylena&quot;, site[&#39;data&#39;][&#39;contributors&#39;][&#39;hexylena&#39;], site)
=&gt; {
  &quot;@context&quot;: &quot;https://schema.org&quot;,
  &quot;@type&quot;: &quot;Person&quot;,
  &quot;http://purl.org/dc/terms/conformsTo&quot;: {
    # Bioschemas profile
    &quot;@id&quot;: &quot;https://bioschemas.org/profiles/Person/0.2-DRAFT-2019_07_19&quot;,
    &quot;@type&quot;: &quot;Person&quot;
  },
  &quot;url&quot;: &quot;https://training.galaxyproject.org/hall-of-fame/hexylena/&quot;,
  &quot;mainEntityOfPage&quot;: &quot;https://training.galaxyproject.org/hall-of-fame/hexylena/&quot;,
  &quot;name&quot;: &quot;hexylena&quot;,
  &quot;image&quot;: &quot;https://avatars.githubusercontent.com/hexylena&quot;,
  &quot;description&quot;: &quot;A contributor to the GTN project.&quot;,
  &quot;memberOf&quot;: [...],
  &quot;identifier&quot;: &quot;https://orcid.org/0000-0002-6601-2165&quot;,
  &quot;orcid&quot;: &quot;https://orcid.org/0000-0002-6601-2165&quot;
}</pre>

          <div class="method-source-code" id="generate_person_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_person_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">member_of</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_contributor</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">id</span>)[<span class="ruby-string">&#39;affiliations&#39;</span>] <span class="ruby-operator">||</span> []
  <span class="ruby-identifier">member_of</span> = <span class="ruby-identifier">member_of</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">org_id</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">org</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_contributor</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">org_id</span>)
    <span class="ruby-identifier">generate_org_jsonld</span>(<span class="ruby-identifier">org_id</span>, <span class="ruby-identifier">org</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">person</span> = {
    <span class="ruby-value">&#39;@context&#39;:</span> <span class="ruby-string">&#39;https://schema.org&#39;</span>,
    <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;Person&#39;</span>,
    <span class="ruby-value">&#39;http://purl.org/dc/terms/conformsTo&#39;:</span> {
      <span class="ruby-value">&#39;@id&#39;:</span> <span class="ruby-string">&#39;https://bioschemas.org/profiles/Person/0.3-DRAFT&#39;</span>,
      <span class="ruby-value">&#39;@type&#39;:</span> <span class="ruby-string">&#39;CreativeWork&#39;</span>
    },
    <span class="ruby-comment"># I guess these are identical?</span>
    <span class="ruby-value">url:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}/hall-of-fame/#{id}/&quot;</span>,
    <span class="ruby-value">mainEntityOfPage:</span> <span class="ruby-node">&quot;#{site[&#39;url&#39;]}#{site[&#39;baseurl&#39;]}/hall-of-fame/#{id}/&quot;</span>,
    <span class="ruby-value">name:</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_name</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">id</span>),
    <span class="ruby-value">image:</span> <span class="ruby-node">&quot;https://avatars.githubusercontent.com/#{id}&quot;</span>,
    <span class="ruby-comment"># No clue what to put here it&#39;s a person.</span>
    <span class="ruby-value">description:</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">nil?</span>
                   <span class="ruby-string">&#39;A contributor to the GTN project.&#39;</span>
                 <span class="ruby-keyword">else</span>
                   <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;bio&#39;</span>,
                                     <span class="ruby-string">&#39;A contributor to the GTN project.&#39;</span>)
                 <span class="ruby-keyword">end</span>,
    <span class="ruby-value">memberOf:</span> [<span class="ruby-constant">GTN</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">member_of</span>,
  }
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contributor</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;orcid&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contributor</span>[<span class="ruby-string">&#39;orcid&#39;</span>]
    <span class="ruby-identifier">person</span>[<span class="ruby-string">&#39;identifier&#39;</span>] = <span class="ruby-node">&quot;https://orcid.org/#{contributor[&#39;orcid&#39;]}&quot;</span>
    <span class="ruby-identifier">person</span>[<span class="ruby-string">&#39;orcid&#39;</span>] = <span class="ruby-node">&quot;https://orcid.org/#{contributor[&#39;orcid&#39;]}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">person</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">to_jsonld</span><span
              class="method-args">(material, topic, site)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Convert a material to JSON-LD, intended to be used in <a href="../Jekyll.html"><code>Jekyll</code></a> Liquid templates. Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>material</code>
<dd>
<p>The material object.</p>
</dd><dt><code>topic</code>
<dd>
<p>The topic object.</p>
</dd><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> site object.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code>
<dd>
<p>The JSON-LD metadata.</p>
</dd></dl>

          <div class="method-source-code" id="to_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 633</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_jsonld</span>(<span class="ruby-identifier">material</span>, <span class="ruby-identifier">topic</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>(<span class="ruby-identifier">generate_material_jsonld</span>(<span class="ruby-identifier">material</span>, <span class="ruby-identifier">topic</span>, <span class="ruby-identifier">site</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_pfo_jsonld" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">to_pfo_jsonld</span><span
              class="method-args">(id, site, json: true)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Generate the JSON-LD metadata for a person, funder, or organisation as JSON. Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>id</code>
<dd>
<p>The id of the person.</p>
</dd><dt><code>site</code>
<dd>
<p>The site object.</p>
</dd><dt><code>json</code>
<dd>
<p>Should the output be rendered as JSON (only really used in contributor page.)</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code>
<dd>
<p>The JSON-LD metadata.</p>
</dd></dl>

          <div class="method-source-code" id="to_pfo_jsonld-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-jsonld.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_pfo_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">site</span>, <span class="ruby-value">json:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">contributor</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_contributor</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">d</span> = <span class="ruby-keyword">if</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">person?</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">id</span>)
        <span class="ruby-identifier">generate_person_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">grant?</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">id</span>)
        <span class="ruby-identifier">generate_grant_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">generate_org_jsonld</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">contributor</span>, <span class="ruby-identifier">site</span>)
      <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">json</span>
    <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>(<span class="ruby-identifier">d</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">d</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.5.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

