<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Gtn::Notebooks - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-add_metadata_cell">::add_metadata_cell</a>
    <li ><a href="#method-c-construct_byline">::construct_byline</a>
    <li ><a href="#method-c-convert_notebook_markdown">::convert_notebook_markdown</a>
    <li ><a href="#method-c-fixBashNotebook">::fixBashNotebook</a>
    <li ><a href="#method-c-fixPythonNotebook">::fixPythonNotebook</a>
    <li ><a href="#method-c-fixRNotebook">::fixRNotebook</a>
    <li ><a href="#method-c-fixSqlNotebook">::fixSqlNotebook</a>
    <li ><a href="#method-c-generate_css">::generate_css</a>
    <li ><a href="#method-c-group_doc_by_first_char">::group_doc_by_first_char</a>
    <li ><a href="#method-c-markdownify">::markdownify</a>
    <li ><a href="#method-c-notebook_filter">::notebook_filter</a>
    <li ><a href="#method-c-renderMarkdownCells">::renderMarkdownCells</a>
    <li ><a href="#method-c-render_jupyter_notebook">::render_jupyter_notebook</a>
    <li ><a href="#method-c-render_rmarkdown">::render_rmarkdown</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Gtn::Notebooks">
  <h1 id="module-Gtn::Notebooks" class="module">
    module Gtn::Notebooks
  </h1>

  <section class="description">
    
<p>Notebook generation module, this converts markdown into Jupyter and RMarkdown/Quarto notebooks</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">


    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
        <dt id="COLORS">COLORS
        <dd><p>Colors for the various boxes, based on our 2024 CSS</p>
        <dt id="COLORS_EXTRA">COLORS_EXTRA
        <dd><p><code>COLORS</code> but hide the agenda box.</p>
        <dt id="ICONS">ICONS
        <dd><p>Emoji icons for the various boxes</p>
        <dt id="ICONS_FA">ICONS_FA
        <dd><p>Font-awesome equivalents of the icons we use for our boxes</p>
      </dl>
    </section>



     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-add_metadata_cell" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">add_metadata_cell</span><span
              class="method-args">(site, notebook, metadata)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Given a notebook, add the metadata cell to the top of the notebook with the agenda, license, LOs, etc.</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <a href="../Jekyll.html"><code>Jekyll</code></a> site object</p>
</dd><dt><code>notebook</code>
<dd>
<p>The notebook to add the metadata cell to</p>
</dd><dt><code>metadata</code>
<dd>
<p>The page.data to construct use for metadata.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The updated notebook with the metadata cell added to the top.</p>
</dd></dl>

          <div class="method-source-code" id="add_metadata_cell-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 233</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">add_metadata_cell</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">notebook</span>, <span class="ruby-identifier">metadata</span>)
  <span class="ruby-identifier">by_line</span> = <span class="ruby-identifier">construct_byline</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">metadata</span>)

  <span class="ruby-identifier">meta_header</span> = [
    <span class="ruby-string">&quot;&lt;div style=\&quot;border: 2px solid #8A9AD0; margin: 1em 0.2em; padding: 0.5em;\&quot;&gt;\n\n&quot;</span>,
    <span class="ruby-node">&quot;# #{metadata[&#39;title&#39;]}\n&quot;</span>,
    <span class="ruby-string">&quot;\n&quot;</span>,
    <span class="ruby-node">&quot;by #{by_line}\n&quot;</span>,
    <span class="ruby-string">&quot;\n&quot;</span>,
    <span class="ruby-node">&quot;#{metadata.fetch(&#39;license&#39;, &#39;CC-BY&#39;)} licensed content from the [Galaxy Training Network]&quot;</span> \
    <span class="ruby-string">&quot;(https://training.galaxyproject.org/)\n&quot;</span>,
    <span class="ruby-string">&quot;\n&quot;</span>,
    <span class="ruby-string">&quot;**Objectives**\n&quot;</span>,
    <span class="ruby-string">&quot;\n&quot;</span>
  ] <span class="ruby-operator">+</span> <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">fetch2</span>(<span class="ruby-string">&#39;questions&#39;</span>, []).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;- #{q}\n&quot;</span> } <span class="ruby-operator">+</span> [
    <span class="ruby-string">&quot;\n&quot;</span>,
    <span class="ruby-string">&quot;**Objectives**\n&quot;</span>,
    <span class="ruby-string">&quot;\n&quot;</span>
  ] <span class="ruby-operator">+</span> <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">fetch2</span>(<span class="ruby-string">&#39;objectives&#39;</span>, []).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;- #{q}\n&quot;</span> } <span class="ruby-operator">+</span> [
    <span class="ruby-string">&quot;\n&quot;</span>,
    <span class="ruby-node">&quot;**Time Estimation: #{metadata[&#39;time_estimation&#39;]}**\n&quot;</span>,
    <span class="ruby-string">&quot;\n&quot;</span>,
    <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>
  ]
  <span class="ruby-identifier">metadata_cell</span> = {
    <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;metadata&#39;</span>,
    <span class="ruby-string">&#39;cell_type&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;markdown&#39;</span>,
    <span class="ruby-string">&#39;source&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">meta_header</span>
  }
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>].<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">metadata_cell</span>)
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-construct_byline" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">construct_byline</span><span
              class="method-args">(site, metadata)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Construct a byline from the metadata</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <a href="../Jekyll.html"><code>Jekyll</code></a> site object</p>
</dd><dt><code>metadata</code>
<dd>
<p>The metadata to construct the byline from, including a contributions or contributors key</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code>
<dd>
<p>The byline with markdown hyperlinks to the contributors</p>
</dd></dl>

          <div class="method-source-code" id="construct_byline-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">construct_byline</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">metadata</span>)
  <span class="ruby-identifier">folks</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_authors</span>(<span class="ruby-identifier">metadata</span>)
  <span class="ruby-identifier">folks</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">fetch_name</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">c</span>)
    <span class="ruby-node">&quot;[#{name}](https://training.galaxyproject.org/hall-of-fame/#{c}/)&quot;</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;, &#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-convert_notebook_markdown" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">convert_notebook_markdown</span><span
              class="method-args">(content, accepted_languages)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Convert a markdown file into a Jupyter notebook JSON structure.</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>content</code>
<dd>
<p>The markdown content to convert</p>
</dd><dt><code>accepted_languages</code>
<dd>
<p>The languages to accept as code blocks. Code blocks that do not match will not be accepted.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>A JSON structure representing the Jupyter notebook.</p>
</dd></dl>

          <div class="method-source-code" id="convert_notebook_markdown-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">convert_notebook_markdown</span>(<span class="ruby-identifier">content</span>, <span class="ruby-identifier">accepted_languages</span>)
  <span class="ruby-identifier">out</span> = []
  <span class="ruby-identifier">inside_block</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">cur_lang</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">val</span> = []
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">content</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^```(#{accepted_languages.join(&#39;|&#39;)})\s*$/</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">inside_block</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-identifier">data</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>]
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;[GTN/Notebook] L#{i} Error! we&#39;re already in a block:&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment"># End the previous block</span>
      <span class="ruby-identifier">out</span>.<span class="ruby-identifier">push</span>([<span class="ruby-identifier">val</span>, <span class="ruby-identifier">inside_block</span>, <span class="ruby-identifier">cur_lang</span>])
      <span class="ruby-identifier">val</span> = []

      <span class="ruby-identifier">inside_block</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">cur_lang</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>]
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">inside_block</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;```&#39;</span>
      <span class="ruby-comment"># End of code block</span>
      <span class="ruby-identifier">out</span>.<span class="ruby-identifier">push</span>([<span class="ruby-identifier">val</span>, <span class="ruby-identifier">inside_block</span>, <span class="ruby-identifier">cur_lang</span>])
      <span class="ruby-identifier">val</span> = []
      <span class="ruby-identifier">inside_block</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">val</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># final flush</span>
  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">push</span>([<span class="ruby-identifier">val</span>, <span class="ruby-identifier">inside_block</span>, <span class="ruby-identifier">cur_lang</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">notebook</span> = {
    <span class="ruby-string">&#39;metadata&#39;</span> <span class="ruby-operator">=&gt;</span> {},
    <span class="ruby-string">&#39;nbformat&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">4</span>,
    <span class="ruby-string">&#39;nbformat_minor&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">5</span>,
  }

  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>] = <span class="ruby-identifier">out</span>.<span class="ruby-identifier">map</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">data2</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">res</span> = {
      <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;cell-#{index}&quot;</span>,
      <span class="ruby-string">&#39;source&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">data2</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{x.rstrip}\n&quot;</span> }
    }
    <span class="ruby-comment"># Strip the trailing newline in the last cell.</span>
    <span class="ruby-identifier">res</span>[<span class="ruby-string">&#39;source&#39;</span>][<span class="ruby-value">-1</span>] = <span class="ruby-identifier">res</span>[<span class="ruby-string">&#39;source&#39;</span>][<span class="ruby-value">-1</span>].<span class="ruby-identifier">rstrip</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>

    <span class="ruby-comment"># Remove any remaining language tagged code blocks, e.g. in</span>
    <span class="ruby-comment"># tip/solution/etc boxes. These do not render well.</span>
    <span class="ruby-identifier">res</span>[<span class="ruby-string">&#39;source&#39;</span>] = <span class="ruby-identifier">res</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/```(#{accepted_languages.join(&#39;|&#39;)})/</span>, <span class="ruby-string">&#39;```&#39;</span>) }

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">data2</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">res</span>.<span class="ruby-identifier">update</span>({
                   <span class="ruby-string">&#39;cell_type&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;code&#39;</span>,
                   <span class="ruby-string">&#39;execution_count&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,
                   <span class="ruby-string">&#39;outputs&#39;</span> <span class="ruby-operator">=&gt;</span> [],
                   <span class="ruby-string">&#39;metadata&#39;</span> <span class="ruby-operator">=&gt;</span> {
                     <span class="ruby-string">&#39;attributes&#39;</span> <span class="ruby-operator">=&gt;</span> {
                       <span class="ruby-string">&#39;classes&#39;</span> <span class="ruby-operator">=&gt;</span> [
                         <span class="ruby-identifier">data</span>[<span class="ruby-value">2</span>]
                       ],
                       <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;&#39;</span>,
                     }
                   }
                 })
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">res</span>[<span class="ruby-string">&#39;cell_type&#39;</span>] = <span class="ruby-string">&#39;markdown&#39;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">res</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-fixBashNotebook" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">fixBashNotebook</span><span
              class="method-args">(notebook)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Similar to <code>fixRNotebook</code> but for bash.</p>

          <div class="method-source-code" id="fixBashNotebook-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fixBashNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-comment"># Set the bash kernel</span>
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;metadata&#39;</span>] = {
    <span class="ruby-string">&#39;kernelspec&#39;</span> <span class="ruby-operator">=&gt;</span> {
      <span class="ruby-string">&#39;display_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Bash&#39;</span>,
      <span class="ruby-string">&#39;language&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;bash&#39;</span>,
      <span class="ruby-string">&#39;name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;bash&#39;</span>
    },
    <span class="ruby-string">&#39;language_info&#39;</span> <span class="ruby-operator">=&gt;</span> {
      <span class="ruby-string">&#39;codemirror_mode&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;shell&#39;</span>,
      <span class="ruby-string">&#39;file_extension&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;.sh&#39;</span>,
      <span class="ruby-string">&#39;mimetype&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;text/x-sh&#39;</span>,
      <span class="ruby-string">&#39;name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;bash&#39;</span>
    }
  }
  <span class="ruby-comment"># Strip out %%bash since we&#39;ll use the bash kernel</span>
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;cell_type&#39;</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&#39;code&#39;</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;%%bash\n&quot;</span>)
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>] = <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">slice</span>(<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cell</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-fixPythonNotebook" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">fixPythonNotebook</span><span
              class="method-args">(notebook)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Similar to <code>fixRNotebook</code> but for Python, bash cells are accepted but must be prefixed with !</p>

          <div class="method-source-code" id="fixPythonNotebook-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 324</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fixPythonNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-comment"># TODO</span>
  <span class="ruby-comment"># prefix bash cells with `!`</span>
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;metadata&#39;</span>, {}).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;attributes&#39;</span>, {}).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;classes&#39;</span>, [])[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;bash&#39;</span>
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>] = <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;!#{line}&quot;</span> }
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cell</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-fixRNotebook" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">fixRNotebook</span><span
              class="method-args">(notebook)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Fix an R based Jupyter notebook by setting the kernel to R and stripping out the %%R magic commands.</p>

          <div class="method-source-code" id="fixRNotebook-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fixRNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-comment"># Set the bash kernel</span>
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;etadata&#39;</span>] = {
    <span class="ruby-string">&#39;kernelspec&#39;</span> <span class="ruby-operator">=&gt;</span> {
      <span class="ruby-string">&#39;display_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;R&#39;</span>,
      <span class="ruby-string">&#39;language&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;R&#39;</span>,
      <span class="ruby-string">&#39;name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;r&#39;</span>
    },
    <span class="ruby-string">&#39;language_info&#39;</span> <span class="ruby-operator">=&gt;</span> {
      <span class="ruby-string">&#39;codemirror_mode&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;r&#39;</span>,
      <span class="ruby-string">&#39;file_extension&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;.r&#39;</span>,
      <span class="ruby-string">&#39;mimetype&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;text/x-r-source&#39;</span>,
      <span class="ruby-string">&#39;name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;R&#39;</span>,
      <span class="ruby-string">&#39;pygments_lexer&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;r&#39;</span>,
      <span class="ruby-string">&#39;version&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;4.1.0&#39;</span>
    }
  }
  <span class="ruby-comment"># Strip out %%R since we&#39;ll use the bash kernel</span>
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;cell_type&#39;</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&#39;code&#39;</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;%%R\n&quot;</span>)
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>] = <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">slice</span>(<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cell</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-fixSqlNotebook" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">fixSqlNotebook</span><span
              class="method-args">(notebook)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Ibid, <code>fixRNotebook</code> but for SQL.</p>

          <div class="method-source-code" id="fixSqlNotebook-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 338</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fixSqlNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-comment"># Add in a %%sql at the top of each cell</span>
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;cell_type&#39;</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&#39;code&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">join</span>.<span class="ruby-identifier">index</span>(<span class="ruby-string">&#39;load_ext&#39;</span>).<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>] = [<span class="ruby-string">&quot;%%sql\n&quot;</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cell</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-generate_css" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">generate_css</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Generate the CSS to be included, by mapping our colors to appropriate classes.</p>

          <div class="method-source-code" id="generate_css-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">generate_css</span>
  <span class="ruby-constant">COLORS</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-node">&quot;.#{key} { padding: 0 1em; margin: 1em 0.2em; border: 2px solid #{val} }&quot;</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-group_doc_by_first_char" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">group_doc_by_first_char</span><span
              class="method-args">(data)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Group a document by the first character seen, which extracts blockquotes mostly.</p>

          <div class="method-source-code" id="group_doc_by_first_char-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">group_doc_by_first_char</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">out</span> = []
  <span class="ruby-identifier">first_char</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">val</span> = []
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)

  <span class="ruby-comment"># Here we collapse running groups of `&gt;` into single blocks.</span>
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">first_char</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">first_char</span> = <span class="ruby-identifier">line</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">val</span> = [<span class="ruby-identifier">line</span>]
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">line</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">first_char</span>
      <span class="ruby-identifier">val</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">line</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;{:&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">first_char</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&gt;&#39;</span>
      <span class="ruby-identifier">val</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># flush</span>
      <span class="ruby-identifier">out</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">val</span>)
      <span class="ruby-identifier">first_char</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">size</span>.<span class="ruby-identifier">positive?</span>
                     <span class="ruby-identifier">line</span>[<span class="ruby-value">0</span>]
                   <span class="ruby-keyword">else</span>
                     <span class="ruby-string">&#39;&#39;</span>
                   <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">val</span> = [<span class="ruby-identifier">line</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># final flush</span>
  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">val</span>)

  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">reject!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    (<span class="ruby-identifier">v</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&gt;&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">-1</span>][<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;{:&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/.agenda/</span>))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&gt;&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">-1</span>][<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;{:&#39;</span>
      <span class="ruby-identifier">cls</span> = <span class="ruby-identifier">v</span>[<span class="ruby-value">-1</span>][<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">strip</span>
      <span class="ruby-identifier">res</span> = [<span class="ruby-node">&quot;:::{#{cls}}&quot;</span>]
      <span class="ruby-identifier">res</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^&gt;\s*/</span>, <span class="ruby-string">&#39;&#39;</span>) }
      <span class="ruby-identifier">res</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&#39;:::&#39;</span>]
      <span class="ruby-identifier">res</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">v</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">flatten</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-markdownify" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">markdownify</span><span
              class="method-args">(site, text)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Call Jekyll’s markdown plugin or failover to Kramdown</p>

<p>I have no idea why that failure mode is supported, that’s kinda wild.</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <a href="../Jekyll.html"><code>Jekyll</code></a> site object</p>
</dd><dt><code>text</code>
<dd>
<p>The text to convert to html</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code>
<dd>
<p>The HTML representation</p>
</dd></dl>

          <div class="method-source-code" id="markdownify-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 360</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">markdownify</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">text</span>)
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">find_converter_instance</span>(
    <span class="ruby-constant">Jekyll</span><span class="ruby-operator">::</span><span class="ruby-constant">Converters</span><span class="ruby-operator">::</span><span class="ruby-constant">Markdown</span>
  ).<span class="ruby-identifier">convert</span>(<span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_s</span>)
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;kramdown&#39;</span>
  <span class="ruby-constant">Kramdown</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">text</span>).<span class="ruby-identifier">to_html</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-notebook_filter" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">notebook_filter</span><span
              class="method-args">(data, language = nil)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Return true if it’s a notebook and the language is correct</p>

<p>TODO: convert to ‘notebook?` which is more ruby-esque.</p>
<dl class="rdoc-list note-list"><dt><code>data</code>
<dd>
<p>The page data to check</p>
</dd><dt><code>language</code>
<dd>
<p>The language to check for</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Boolean</code>
<dd>
<p>True if it’s a notebook (i.e hands on tutorial, has a notebook key, and the language is correct)</p>
</dd></dl>

          <div class="method-source-code" id="notebook_filter-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 379</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">notebook_filter</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">language</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;layout&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial_hands_on&#39;</span> \
    <span class="ruby-keyword">and</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;notebook&#39;</span>) \
    <span class="ruby-keyword">and</span> (<span class="ruby-identifier">language</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;notebook&#39;</span>][<span class="ruby-string">&#39;language&#39;</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">language</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-renderMarkdownCells" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">renderMarkdownCells</span><span
              class="method-args">(site, notebook, metadata, _page_url, dir)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="renderMarkdownCells-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 526</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">renderMarkdownCells</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">notebook</span>, <span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">_page_url</span>, <span class="ruby-identifier">dir</span>)
  <span class="ruby-identifier">seen_abbreviations</span> = {}
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;cell_type&#39;</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&#39;markdown&#39;</span>

      <span class="ruby-comment"># The source is initially a list of strings, we&#39;ll merge it together</span>
      <span class="ruby-comment"># to make it easier to work with.</span>
      <span class="ruby-identifier">source</span> = <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">join</span>.<span class="ruby-identifier">strip</span>

      <span class="ruby-comment"># Here we replace individual `s with codeblocks, they screw up</span>
      <span class="ruby-comment"># rendering otherwise by going through rouge</span>
      <span class="ruby-identifier">source</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/ `([^`]*)`([^`])/</span>, <span class="ruby-string">&#39; &lt;code&gt;\1&lt;/code&gt;\2&#39;</span>)
                     .<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/([^`])`([^`]*)` /</span>, <span class="ruby-string">&#39;\1&lt;code&gt;\2&lt;/code&gt; &#39;</span>)

      <span class="ruby-comment"># Strip out includes, snippets</span>
      <span class="ruby-identifier">source</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/{% include .* %}/</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-identifier">source</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/{% snippet .* %}/</span>, <span class="ruby-string">&#39;&#39;</span>)

      <span class="ruby-comment"># Replace all the broken icons that can&#39;t render, because we don&#39;t</span>
      <span class="ruby-comment"># have access to the full render pipeline.</span>
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>] = <span class="ruby-identifier">markdownify</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">source</span>)

      <span class="ruby-constant">ICONS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
        <span class="ruby-comment"># Replace the new box titles with h3s.</span>
        <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">%r{&lt;div class=&quot;box-title #{key}-title&quot;.*?&lt;/span&gt;(.*?)&lt;/div&gt;}</span>,
                             <span class="ruby-node">&quot;&lt;div style=\&quot;font-weight:900;font-size: 125%\&quot;&gt;#{val} \\1&lt;/div&gt;&quot;</span>)

        <span class="ruby-comment"># Remove the fa-icon spans</span>
        <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">%r{&lt;span role=&quot;button&quot; class=&quot;fold-unfold fa fa-minus-square&quot;&gt;&lt;/span&gt;}</span>, <span class="ruby-string">&#39;&#39;</span>)

        <span class="ruby-comment"># just removing the buttons from solutions since they&#39;ll be changed</span>
        <span class="ruby-comment"># into summary/details in the parent notebook-jupyter.</span>
        <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">%r{&lt;button class=&quot;gtn-boxify-button solution&quot;.*?&lt;/button&gt;}</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;abbreviations&#39;</span>)
        <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&#39;abbreviations&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">abbr</span>, <span class="ruby-identifier">defn</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\{#{abbr}\}/</span>) <span class="ruby-keyword">do</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">seen_abbreviations</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">abbr</span>)
              <span class="ruby-identifier">firstdef</span> = <span class="ruby-keyword">false</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">firstdef</span> = <span class="ruby-keyword">true</span>
              <span class="ruby-identifier">seen_abbreviations</span>[<span class="ruby-identifier">abbr</span>] = <span class="ruby-keyword">true</span>
            <span class="ruby-keyword">end</span>

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">firstdef</span>
              <span class="ruby-node">&quot;#{defn} (#{abbr})&quot;</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-node">&quot;&lt;abbr title=\&quot;#{defn}\&quot;&gt;#{abbr}&lt;/abbr&gt;&quot;</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Here we give a GTN-ish styling that doesn&#39;t try to be too faithful,</span>
      <span class="ruby-comment"># so we aren&#39;t spending time keeping up with changes to GTN css,</span>
      <span class="ruby-comment"># we&#39;re making it &#39;our own&#39; a bit.</span>

      <span class="ruby-constant">COLORS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">val</span> = <span class="ruby-node">&quot;#{val};#{COLORS_EXTRA[key]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">COLORS_EXTRA</span>.<span class="ruby-identifier">key?</span> <span class="ruby-identifier">key</span>

        <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;blockquote class=&quot;#{key}&quot;&gt;/</span>,
                             <span class="ruby-node">&quot;&lt;blockquote class=\&quot;#{key}\&quot; style=\&quot;border: 2px solid #{val}; margin: 1em 0.2em\&quot;&gt;&quot;</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Images are referenced in the through relative URLs which is</span>
      <span class="ruby-comment"># fab, but in a notebook this doesn&#39;t make sense as it will live</span>
      <span class="ruby-comment"># outside of the GTN. We need real URLs.</span>
      <span class="ruby-comment">#</span>
      <span class="ruby-comment"># So either we&#39;ll embed the images directly via base64 encoding (cool,</span>
      <span class="ruby-comment"># love it) or we&#39;ll link to the production images and folks can live</span>
      <span class="ruby-comment"># without their images for a bit until it&#39;s merged.</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/&lt;img src=&quot;\.\./</span>)
        <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;img src=&quot;(\.\.[^&quot;]*)/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">img</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">path</span> = <span class="ruby-identifier">img</span>[<span class="ruby-value">10</span><span class="ruby-operator">..</span>]
          <span class="ruby-identifier">image_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">path</span>)

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">img</span>[<span class="ruby-value">-3</span><span class="ruby-operator">..</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;png&#39;</span>
            <span class="ruby-identifier">data</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">image_path</span>))
            <span class="ruby-node">%(&lt;img src=&quot;data:image/png;base64,#{data}&quot;)</span>
          <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">img</span>[<span class="ruby-value">-3</span><span class="ruby-operator">..</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;jpg&#39;</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">img</span>[<span class="ruby-value">-4</span><span class="ruby-operator">..</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;jpeg&#39;</span>)
            <span class="ruby-identifier">data</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">image_path</span>))
            <span class="ruby-node">%(&lt;img src=&quot;data:image/jpeg;base64,#{data}&quot;)</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">img</span>[<span class="ruby-value">-3</span><span class="ruby-operator">..</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;svg&#39;</span>
            <span class="ruby-identifier">data</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">image_path</span>))
            <span class="ruby-node">%(&lt;img src=&quot;data:image/svg+xml;base64,#{data}&quot;)</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment"># Falling back to non-embedded images</span>
            <span class="ruby-node">&quot;&lt;img src=\&quot;https://training.galaxyproject.org/training-material/#{page_url.split(&#39;/&#39;)[0..-2].join(&#39;/&#39;)}/..&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Strip out the highlighting as it is bad on some platforms.</span>
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;pre class=&quot;highlight&quot;&gt;/</span>, <span class="ruby-string">&#39;&lt;pre style=&quot;color: inherit; background: transparent&quot;&gt;&#39;</span>)
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;div class=&quot;highlight&quot;&gt;/</span>, <span class="ruby-string">&#39;&lt;div&gt;&#39;</span>)
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;code&gt;/</span>, <span class="ruby-string">&#39;&lt;code style=&quot;color: inherit&quot;&gt;&#39;</span>)

      <span class="ruby-comment"># There is some weirdness in the processing of $s in Jupyter. After a</span>
      <span class="ruby-comment"># certain number of them, it will give up, and just render everything</span>
      <span class="ruby-comment"># like with a &#39;&lt;pre&gt;&#39;. We remove this to prevent that result.</span>
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/^\s*&lt;/</span>, <span class="ruby-string">&#39;&lt;&#39;</span>)
      <span class="ruby-comment"># Additionally leading spaces are sometimes interpreted as &lt;pre&gt;s and</span>
      <span class="ruby-comment"># end up causing paragraphs to be rendered as code. So we wipe out</span>
      <span class="ruby-comment"># all leading space.</span>
      <span class="ruby-comment"># &#39;editable&#39; is actually CoCalc specific but oh well.</span>
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;metadata&#39;</span>] = { <span class="ruby-string">&#39;editable&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&#39;collapsed&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span> }
      <span class="ruby-identifier">cell</span>[<span class="ruby-string">&#39;source&#39;</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\$/</span>, <span class="ruby-string">&#39;&amp;#36;&#39;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cell</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-render_jupyter_notebook" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">render_jupyter_notebook</span><span
              class="method-args">(data, content, url, _last_modified, notebook_language, site, dir)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="render_jupyter_notebook-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 475</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">render_jupyter_notebook</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">content</span>, <span class="ruby-identifier">url</span>, <span class="ruby-identifier">_last_modified</span>, <span class="ruby-identifier">notebook_language</span>, <span class="ruby-identifier">site</span>, <span class="ruby-identifier">dir</span>)
  <span class="ruby-comment"># Here we read use internal methods to convert the tutorial to a Hash</span>
  <span class="ruby-comment"># representing the notebook</span>
  <span class="ruby-identifier">accepted_languages</span> = [<span class="ruby-identifier">notebook_language</span>]
  <span class="ruby-identifier">accepted_languages</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;bash&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">notebook_language</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;python&#39;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;zenodo_link&#39;</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Replacing zenodo links in #{url}, #{data[&#39;zenodo_link&#39;]}&quot;</span>
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/{{\s*page.zenodo_link\s*}}/</span>, <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;zenodo_link&#39;</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">notebook</span> = <span class="ruby-identifier">convert_notebook_markdown</span>(<span class="ruby-identifier">content</span>, <span class="ruby-identifier">accepted_languages</span>)
  <span class="ruby-comment"># This extracts the metadata yaml header and does manual formatting of</span>
  <span class="ruby-comment"># the header data to make for a nicer notebook.</span>
  <span class="ruby-identifier">notebook</span> = <span class="ruby-identifier">add_metadata_cell</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">notebook</span>, <span class="ruby-identifier">data</span>)

  <span class="ruby-comment"># Apply language specific conventions</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">notebook_language</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;bash&#39;</span>
    <span class="ruby-identifier">notebook</span> = <span class="ruby-identifier">fixBashNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;sql&#39;</span>
    <span class="ruby-identifier">notebook</span> = <span class="ruby-identifier">fixSqlNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;r&#39;</span>
    <span class="ruby-identifier">notebook</span> = <span class="ruby-identifier">fixRNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;python&#39;</span>
    <span class="ruby-identifier">notebook</span> = <span class="ruby-identifier">fixPythonNotebook</span>(<span class="ruby-identifier">notebook</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Here we loop over the markdown cells and render them to HTML. This</span>
  <span class="ruby-comment"># allows us to get rid of classes like {: .tip} that would be left in</span>
  <span class="ruby-comment"># the output by Jupyter&#39;s markdown renderer, and additionally do any</span>
  <span class="ruby-comment"># custom CSS which only seems to work when inline on a cell, i.e. we</span>
  <span class="ruby-comment"># can&#39;t setup a style block, so we really need to render the markdown</span>
  <span class="ruby-comment"># to html.</span>
  <span class="ruby-identifier">notebook</span> = <span class="ruby-identifier">renderMarkdownCells</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">notebook</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">url</span>, <span class="ruby-identifier">dir</span>)

  <span class="ruby-comment"># Here we add a close to the notebook</span>
  <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>] = <span class="ruby-identifier">notebook</span>[<span class="ruby-string">&#39;cells&#39;</span>] <span class="ruby-operator">+</span> [{
    <span class="ruby-string">&#39;cell_type&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;markdown&#39;</span>,
    <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;final-ending-cell&#39;</span>,
    <span class="ruby-string">&#39;metadata&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;editable&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&#39;collapsed&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span> },
    <span class="ruby-string">&#39;source&#39;</span> <span class="ruby-operator">=&gt;</span> [
      <span class="ruby-string">&quot;# Key Points\n\n&quot;</span>
    ] <span class="ruby-operator">+</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch2</span>(<span class="ruby-string">&#39;key_points&#39;</span>, []).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;- #{k}\n&quot;</span> } <span class="ruby-operator">+</span> [
      <span class="ruby-string">&quot;\n# Congratulations on successfully completing this tutorial!\n\n&quot;</span>,
      <span class="ruby-string">&#39;Please [fill out the feedback on the GTN website](https://training.galaxyproject.org/training-material&#39;</span> \
      <span class="ruby-node">&quot;#{url}#feedback) and check there for further resources!\n&quot;</span>
    ]
  }]
  <span class="ruby-identifier">notebook</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-render_rmarkdown" class="method-detail ">
        <div class="method-header">
          <div class="method-heading">
            <span class="method-name">render_rmarkdown</span><span
              class="method-args">(site, page_data, page_content, page_url, page_last_modified, fn)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
        </div>

        <div class="method-description">
          <p>Massage a page into RMarkdown preferred formatting.</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <a href="../Jekyll.html"><code>Jekyll</code></a> site object</p>
</dd><dt><code>page_data</code>
<dd>
<p>The page metadata (page.data)</p>
</dd><dt><code>page_content</code>
<dd>
<p>The page content (page.content)</p>
</dd><dt><code>page_url</code>
<dd>
<p>The page URL</p>
</dd><dt><code>page_last_modified</code>
<dd>
<p>The last modified time of the page</p>
</dd><dt><code>fn</code>
<dd>
<p>The source filename of the page</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code>
<dd>
<p>The RMarkdown formatted content</p>
</dd></dl>

          <div class="method-source-code" id="render_rmarkdown-source">
            <pre><span class="ruby-comment"># File _plugins/notebook.rb, line 399</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">render_rmarkdown</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">page_data</span>, <span class="ruby-identifier">page_content</span>, <span class="ruby-identifier">page_url</span>, <span class="ruby-identifier">page_last_modified</span>, <span class="ruby-identifier">fn</span>)
  <span class="ruby-identifier">by_line</span> = <span class="ruby-identifier">construct_byline</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">page_data</span>)

  <span class="ruby-comment"># Replace top level `&gt;` blocks with fenced `:::`</span>
  <span class="ruby-identifier">content</span> = <span class="ruby-identifier">group_doc_by_first_char</span>(<span class="ruby-identifier">page_content</span>)

  <span class="ruby-comment"># Re-run a second time to catch singly-nested Q&amp;A?</span>
  <span class="ruby-identifier">content</span> = <span class="ruby-identifier">group_doc_by_first_char</span>(<span class="ruby-identifier">content</span>)

  <span class="ruby-comment"># Replace zenodo links, the only replacement we do</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page_data</span>[<span class="ruby-string">&#39;zenodo_link&#39;</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Replacing zenodo links in #{page_url}, #{page_data[&#39;zenodo_link&#39;]}&quot;</span>
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/{{\s*page.zenodo_link\s*}}/</span>, <span class="ruby-identifier">page_data</span>[<span class="ruby-string">&#39;zenodo_link&#39;</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">ICONS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/{% icon #{key} %}/</span>, <span class="ruby-identifier">val</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">ICONS_FA</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">%r{&lt;i class=&quot;#{key}&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;}</span>, <span class="ruby-constant">ICONS</span>[<span class="ruby-identifier">val</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">content</span> <span class="ruby-operator">+=</span> <span class="ruby-string">%(\n\n# References\n\n&lt;div id=&quot;refs&quot;&gt;&lt;/div&gt;\n)</span>

  <span class="ruby-comment"># https://raw.githubusercontent.com/rstudio/cheatsheets/master/rmarkdown-2.0.pdf</span>
  <span class="ruby-comment"># https://bookdown.org/yihui/rmarkdown/</span>

  <span class="ruby-identifier">fnparts</span> = <span class="ruby-identifier">fn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)
  <span class="ruby-identifier">rmddata</span> = {
    <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">page_data</span>[<span class="ruby-string">&#39;title&#39;</span>],
    <span class="ruby-string">&#39;author&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{by_line}, #{page_data.fetch(&#39;license&#39;,
                                               &#39;CC-BY&#39;)} licensed content from the [Galaxy Training Network](https://training.galaxyproject.org/)&quot;</span>,
    <span class="ruby-string">&#39;bibliography&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{fnparts[2]}-#{fnparts[4]}.bib&quot;</span>,
    <span class="ruby-string">&#39;output&#39;</span> <span class="ruby-operator">=&gt;</span> {
      <span class="ruby-string">&#39;html_notebook&#39;</span> <span class="ruby-operator">=&gt;</span> {
        <span class="ruby-string">&#39;toc&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,
        <span class="ruby-string">&#39;toc_depth&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">2</span>,
        <span class="ruby-string">&#39;css&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;gtn.css&#39;</span>,
        <span class="ruby-string">&#39;toc_float&#39;</span> <span class="ruby-operator">=&gt;</span> {
          <span class="ruby-string">&#39;collapsed&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>,
          <span class="ruby-string">&#39;smooth_scroll&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>,
        },
        <span class="ruby-comment"># &#39;theme&#39; =&gt; {&#39;bootswatch&#39; =&gt; &#39;journal&#39;}</span>
      },
      <span class="ruby-string">&#39;word_document&#39;</span> <span class="ruby-operator">=&gt;</span> {
        <span class="ruby-string">&#39;toc&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,
        <span class="ruby-string">&#39;toc_depth&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">2</span>,
        <span class="ruby-string">&#39;latex_engine&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;xelatex&#39;</span>,
      },
      <span class="ruby-string">&#39;pdf_document&#39;</span> <span class="ruby-operator">=&gt;</span> {
        <span class="ruby-string">&#39;toc&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,
        <span class="ruby-string">&#39;toc_depth&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">2</span>,
        <span class="ruby-string">&#39;latex_engine&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;xelatex&#39;</span>,
      },
    },
    <span class="ruby-string">&#39;date&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">page_last_modified</span>.<span class="ruby-identifier">to_s</span>,
    <span class="ruby-string">&#39;link-citations&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-string">&#39;anchor_sections&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-string">&#39;code_download&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,
  }
  <span class="ruby-identifier">rmddata</span>[<span class="ruby-string">&#39;output&#39;</span>][<span class="ruby-string">&#39;html_document&#39;</span>] = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-identifier">rmddata</span>[<span class="ruby-string">&#39;output&#39;</span>][<span class="ruby-string">&#39;html_notebook&#39;</span>]))

  <span class="ruby-identifier">final_content</span> = [
    <span class="ruby-string">&quot;# Introduction\n&quot;</span>,
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/```[Rr]/</span>, <span class="ruby-string">&#39;```{r}&#39;</span>),
    <span class="ruby-string">&quot;# Key Points\n&quot;</span>
  ] <span class="ruby-operator">+</span> <span class="ruby-identifier">page_data</span>.<span class="ruby-identifier">fetch2</span>(<span class="ruby-string">&#39;key_points&#39;</span>, []).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;- #{k}&quot;</span> } <span class="ruby-operator">+</span> [
    <span class="ruby-string">&quot;\n# Congratulations on successfully completing this tutorial!\n&quot;</span>,
    <span class="ruby-string">&#39;Please [fill out the feedback on the GTN website](https://training.galaxyproject.org/&#39;</span> \
    <span class="ruby-node">&quot;training-material#{page_url}#feedback) and check there for further resources!\n&quot;</span>
  ]

  <span class="ruby-node">&quot;#{rmddata.to_yaml(line_width: rmddata[&#39;author&#39;].size + 10)}---\n#{final_content.join(&quot;\n&quot;)}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.5.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

