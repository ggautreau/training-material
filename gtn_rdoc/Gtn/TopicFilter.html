<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>module Gtn::TopicFilter - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document">
  <header class="topbar">
  <div class="width-limiter">
    <div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>

    <a href="../index.html" rel="home">RDoc Documentation</a>
    <button type="button" aria-label="Search" class="search-button">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <span>search</span>
    </button>
  </div>
</header>

<dialog id="search-dialog" role="search" class="search-dialog initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden">
    </ul>
  </form>
</dialog>

  <div class="wrapper">
    <nav id="navigation" role="navigation">
  <div class="nav-section">
  <h3>Class and Module Index</h3>

    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <a href="../DateTime.html">DateTime</a>
          <li class="">
            <details  open>
              <summary><a href="../Gtn.html">Gtn</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <details>
              <summary><a href="../Gtn/Boxify.html">Boxify</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <a href="../Gtn/Boxify/BoxIdTest.html">BoxIdTest</a>
              </ul>
            </details>
          <li class="">
            <a href="../Gtn/Contributors.html">Contributors</a>
          <li class="">
            <a href="../Gtn/Git.html">Git</a>
          <li class="">
            <a href="../Gtn/HashedColours.html">HashedColours</a>
          <li class="">
            <a href="../Gtn/Hooks.html">Hooks</a>
          <li class="">
            <a href="../Gtn/Images.html">Images</a>
          <li class="">
            <details>
              <summary><a href="../Gtn/Linter.html">Linter</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <a href="../Gtn/Linter/Test.html">Test</a>
              </ul>
            </details>
          <li class="">
            <a href="../Gtn/Metrics.html">Metrics</a>
          <li class="">
            <a href="../Gtn/ModificationTimes.html">ModificationTimes</a>
          <li class="">
            <a href="../Gtn/Notebooks.html">Notebooks</a>
          <li class="">
            <a href="../Gtn/PublicationTimes.html">PublicationTimes</a>
          <li class="">
            <a href="../Gtn/ReviewDogEmitter.html">ReviewDogEmitter</a>
          <li class="">
            <a href="../Gtn/RoCrate.html">RoCrate</a>
          <li class="">
            <a href="../Gtn/SchemaValidator.html">SchemaValidator</a>
          <li class="">
            <a href="../Gtn/Scholar.html">Scholar</a>
          <li class="">
            <a href="../Gtn/Shortlinks.html">Shortlinks</a>
          <li class="">
            <a href="../Gtn/Supported.html">Supported</a>
          <li class="">
            <details>
              <summary><a href="../Gtn/Test.html">Test</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <a href="../Gtn/Test/IntersectionTest.html">IntersectionTest</a>
              </ul>
            </details>
          <li class="">
            <a href="../Gtn/Toolshed.html">Toolshed</a>
          <li class="active">
            <a href="../Gtn/TopicFilter.html">TopicFilter</a>
          <li class="">
            <a href="../Gtn/Usegalaxy.html">Usegalaxy</a>
              </ul>
            </details>
          <li class="">
            <a href="../Hash.html">Hash</a>
          <li class="">
            <a href="../Hsluv.html">Hsluv</a>
          <li class="">
            <details>
              <summary><a href="../Jekyll.html">Jekyll</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <details>
              <summary><a href="../Jekyll/Filters.html">Filters</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <a href="../Jekyll/Filters/DurationFilter.html">DurationFilter</a>
          <li class="">
            <a href="../Jekyll/Filters/HashedColours.html">HashedColours</a>
          <li class="">
            <a href="../Jekyll/Filters/JsBundle.html">JsBundle</a>
          <li class="">
            <a href="../Jekyll/Filters/JsonldFilter.html">JsonldFilter</a>
          <li class="">
            <a href="../Jekyll/Filters/TopicFilter.html">TopicFilter</a>
              </ul>
            </details>
          <li class="">
            <details>
              <summary><a href="../Jekyll/Generators.html">Generators</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <a href="../Jekyll/Generators/APIGenerator.html">APIGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/Abbreviate.html">Abbreviate</a>
          <li class="">
            <a href="../Jekyll/Generators/AuthorPageGenerator.html">AuthorPageGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/Boxify.html">Boxify</a>
          <li class="">
            <a href="../Jekyll/Generators/EnvironmentVariablesGenerator.html">EnvironmentVariablesGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/Figurify.html">Figurify</a>
          <li class="">
            <a href="../Jekyll/Generators/PlaintextSlidesGenerator.html">PlaintextSlidesGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/RecordingPageGenerator.html">RecordingPageGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/RmarkdownGenerator.html">RmarkdownGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/SitemapGenerator2.html">SitemapGenerator2</a>
          <li class="">
            <a href="../Jekyll/Generators/SyntheticTopicGenerator.html">SyntheticTopicGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/TagPageGenerator.html">TagPageGenerator</a>
          <li class="">
            <a href="../Jekyll/Generators/WorkflowPageGenerator.html">WorkflowPageGenerator</a>
              </ul>
            </details>
          <li class="">
            <a href="../Jekyll/GtnFunctions.html">GtnFunctions</a>
          <li class="">
            <details>
              <summary><a href="../Jekyll/Tags.html">Tags</a></summary>
    <ul class="link-list" id="class-and-module-index">
          <li class="">
            <a href="../Jekyll/Tags/BibTag.html">BibTag</a>
          <li class="">
            <a href="../Jekyll/Tags/CiteTag.html">CiteTag</a>
          <li class="">
            <a href="../Jekyll/Tags/CiteUrlTag.html">CiteUrlTag</a>
          <li class="">
            <a href="../Jekyll/Tags/ColorPickerTag.html">ColorPickerTag</a>
          <li class="">
            <a href="../Jekyll/Tags/CustomLinkTag.html">CustomLinkTag</a>
          <li class="">
            <a href="../Jekyll/Tags/DumpSearchDataTag.html">DumpSearchDataTag</a>
          <li class="">
            <a href="../Jekyll/Tags/FileExistsTag.html">FileExistsTag</a>
          <li class="">
            <a href="../Jekyll/Tags/IconTag.html">IconTag</a>
          <li class="">
            <a href="../Jekyll/Tags/IconTagVar.html">IconTagVar</a>
          <li class="">
            <a href="../Jekyll/Tags/SnippetIncludeTag.html">SnippetIncludeTag</a>
          <li class="">
            <a href="../Jekyll/Tags/ToolTag.html">ToolTag</a>
          <li class="">
            <a href="../Jekyll/Tags/WorkflowTag.html">WorkflowTag</a>
              </ul>
            </details>
              </ul>
            </details>
          <li class="">
            <a href="../Object.html">Object</a>
</div>

  


<div class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
    <li><details><summary>bin</summary>
    <ul class="link-list">
      <li class=""><a href="../bin/add_galaxy_instance_badges_py.html">add_galaxy_instance_badges.py</a>
      <li class=""><a href="../bin/ari-gen-sample-audio_sh.html">ari-gen-sample-audio.sh</a>
      <li class=""><a href="../bin/ari-make_sh.html">ari-make.sh</a>
      <li class=""><a href="../bin/ari-quick_sh.html">ari-quick.sh</a>
      <li class=""><a href="../bin/ari_sh.html">ari.sh</a>
      <li class=""><a href="../bin/check-broken-boxes_py.html">check-broken-boxes.py</a>
      <li class=""><a href="../bin/check-redirects_sh.html">check-redirects.sh</a>
      <li class=""><a href="../bin/check-url-persistence_sh.html">check-url-persistence.sh</a>
      <li class=""><a href="../bin/data-library-update_sh.html">data-library-update.sh</a>
      <li class=""><a href="../bin/data_libarary_download_sh.html">data_libarary_download.sh</a>
      <li class=""><a href="../bin/docker-install-tutorials_sh.html">docker-install-tutorials.sh</a>
      <li class=""><a href="../bin/find-duplicate-workflows_sh.html">find-duplicate-workflows.sh</a>
      <li class=""><a href="../bin/galaxy-help-news_sh.html">galaxy-help-news.sh</a>
      <li class=""><a href="../bin/gtn-fix_sh.html">gtn-fix.sh</a>
      <li class=""><a href="../bin/install_topic_requirements_sh.html">install_topic_requirements.sh</a>
      <li class=""><a href="../bin/install_tutorial_requirements_sh.html">install_tutorial_requirements.sh</a>
      <li class=""><a href="../bin/knit-automated_sh.html">knit-automated.sh</a>
      <li class=""><a href="../bin/knit-frog_py.html">knit-frog.py</a>
      <li class=""><a href="../bin/knit_py.html">knit.py</a>
      <li class=""><a href="../bin/knittingneedles_py.html">knittingneedles.py</a>
      <li class=""><a href="../bin/lint-diffs_py.html">lint-diffs.py</a>
      <li class=""><a href="../bin/lunr-index_js.html">lunr-index.js</a>
      <li class=""><a href="../bin/lunr-search_js.html">lunr-search.js</a>
      <li class=""><a href="../bin/mergeyaml_py.html">mergeyaml.py</a>
      <li class=""><a href="../bin/pdf2slides_py.html">pdf2slides.py</a>
      <li class=""><a href="../bin/prepare_docker_checks_py.html">prepare_docker_checks.py</a>
      <li class=""><a href="../bin/publish-archive.html">publish-archive</a>
      <li class=""><a href="../bin/schema-contributors_yaml.html">schema-contributors.yaml</a>
      <li class=""><a href="../bin/schema-event-external_yaml.html">schema-event-external.yaml</a>
      <li class=""><a href="../bin/schema-event_yaml.html">schema-event.yaml</a>
      <li class=""><a href="../bin/schema-faq_yaml.html">schema-faq.yaml</a>
      <li class=""><a href="../bin/schema-grants_yaml.html">schema-grants.yaml</a>
      <li class=""><a href="../bin/schema-learning-pathway_yaml.html">schema-learning-pathway.yaml</a>
      <li class=""><a href="../bin/schema-news_yaml.html">schema-news.yaml</a>
      <li class=""><a href="../bin/schema-organisations_yaml.html">schema-organisations.yaml</a>
      <li class=""><a href="../bin/schema-quiz_yaml.html">schema-quiz.yaml</a>
      <li class=""><a href="../bin/schema-requirement-external_yaml.html">schema-requirement-external.yaml</a>
      <li class=""><a href="../bin/schema-requirement-internal_yaml.html">schema-requirement-internal.yaml</a>
      <li class=""><a href="../bin/schema-slides_yaml.html">schema-slides.yaml</a>
      <li class=""><a href="../bin/schema-topic_yaml.html">schema-topic.yaml</a>
      <li class=""><a href="../bin/schema-tutorial_yaml.html">schema-tutorial.yaml</a>
      <li class=""><a href="../bin/setup_training_content_py.html">setup_training_content.py</a>
      <li class=""><a href="../bin/slides-fix_css.html">slides-fix.css</a>
      <li class=""><a href="../bin/social-cards_py.html">social-cards.py</a>
      <li class=""><a href="../bin/supported-fetch_py.html">supported-fetch.py</a>
      <li class=""><a href="../bin/validate-has-workflow_sh.html">validate-has-workflow.sh</a>
      <li class=""><a href="../bin/video-browser-recorder_js.html">video-browser-recorder.js</a>
      <li class=""><a href="../bin/video-builder_py.html">video-builder.py</a>
      <li class=""><a href="../bin/video-diffplayer_py.html">video-diffplayer.py</a>
      <li class=""><a href="../bin/video-extract-script_py.html">video-extract-script.py</a>
      <li class=""><a href="../bin/video-term-demo-magic_sh.html">video-term-demo-magic.sh</a>
      <li class=""><a href="../bin/video-term-recorder_sh.html">video-term-recorder.sh</a>
      <li class=""><a href="../bin/wfh-upload_py.html">wfh-upload.py</a>
      <li class=""><a href="../bin/yaml2json_py.html">yaml2json.py</a>
    </ul></details>
  </ul>
</div>

  <footer role="contentinfo">
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.9.1. <a href="https://validator.w3.org/check/referer">Validate</a>
  <p><a href="http://rorvswild.com/theme">RoRvsWild theme</a> based on <a href="http://deveiate.org">Darkfish</a>.
</footer>
</nav>

    <main role="main" aria-labelledby="module-Gtn::TopicFilter">
      <article>
        <h1 id="module-Gtn::TopicFilter">
          module Gtn::TopicFilter
        </h1>

        
<p>The main GTN module to parse tutorial.md and slides.html and topics into useful lists of things that can be shown on topic pages, i.e. “materials” (a possible combination of tutorial + slides)</p>

<p>This is by far the most complicated module and the least disaggregated/modular part of the GTN infrastructure. <a href="TopicFilter.html#method-c-resolve_material"><code>TopicFilter.resolve_material</code></a> is probably the single most important function in the entire suite.</p>


          





              <section id="public-class-5Buntitled-5D-method-details" class="method-section">
                <header>
                  <h2>Public Class Methods</h2>
                </header>

                  <div id="method-c-annotate_path" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-annotate_path" title="Link to this method">
                            <span class="method-name">annotate_path</span>
                            <span class="method-args">(path, layout)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Annotation of a path with topic and tutorial information Params:</p>
<dl class="rdoc-list note-list"><dt><code>path</code></dt>
<dd>
<p>The path to annotate</p>
</dd><dt><code>layout</code></dt>
<dd>
<p>The page layout if known</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code></dt>
<dd>
<p>The annotation</p>
</dd></dl>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">h</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">TopicFilter</span>.<span class="ruby-identifier">annotate_path</span>(<span class="ruby-string">&quot;topics/assembly/tutorials/velvet-assembly/tutorial.md&quot;</span>, <span class="ruby-keyword">nil</span>)
<span class="ruby-identifier">h</span> <span class="ruby-comment"># =&gt; {</span>
  <span class="ruby-comment">#  &quot;topic&quot;=&gt;&quot;assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;topic_name&quot;=&gt;&quot;assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;material&quot;=&gt;&quot;assembly/velvet-assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;tutorial_name&quot;=&gt;&quot;velvet-assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;dir&quot;=&gt;&quot;topics/assembly/tutorials/velvet-assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;type&quot;=&gt;&quot;tutorial&quot;</span>
  <span class="ruby-comment"># }</span>
</pre>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="annotate_path-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 262</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">annotate_path</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">layout</span>)
  <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)
  <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">shift</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;.&#39;</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;topics&#39;</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;tutorials&#39;</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">4</span>

  <span class="ruby-identifier">material</span> = {
    <span class="ruby-string">&#39;topic&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>], <span class="ruby-comment"># Duplicate</span>
    <span class="ruby-string">&#39;topic_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>],
    <span class="ruby-string">&#39;material&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{parts[1]}/#{parts[3]}&quot;</span>,
    <span class="ruby-string">&#39;tutorial_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">3</span>],
    <span class="ruby-string">&#39;dir&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">3</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;/&#39;</span>),
  }

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r{/faqs/}</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/data[_-]library.yaml/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/data[_-]manager.yaml/</span>

  <span class="ruby-comment"># Check if it&#39;s a symlink</span>
  <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;symlink&#39;</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">symlink?</span>(<span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;dir&#39;</span>])

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/tutorial.*\.md/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">layout</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial_hands_on&#39;</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;tutorial&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/slides.*\.html/</span> <span class="ruby-operator">||</span> <span class="ruby-node">%w[tutorial_slides base_slides introduction_slides]</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">layout</span>)
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;slides&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/ipynb$/</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;ipynb&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/Rmd$/</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;rmd&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;workflows&#39;</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;workflow&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;recordings&#39;</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;recordings&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tours&#39;</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;tour&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;index.md&#39;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-comment"># material[&#39;type&#39;] = &#39;unknown&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">material</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-cache" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-cache" title="Link to this method">
                            <span class="method-name">cache</span>
                            <span class="method-args">()</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Setup the local cache via <code>Jekyll::Cache</code></p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="cache-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">cache</span>
  <span class="ruby-identifier">@@cache</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Jekyll</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;GtnTopicFilter&#39;</span>)
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-collate_materials" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-collate_materials" title="Link to this method">
                            <span class="method-name">collate_materials</span>
                            <span class="method-args">(site, pages)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Collate the materials into a large hash Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>pages</code></dt>
<dd>
<p>The list of pages to collate</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code></dt>
<dd>
<p>The collated materials</p>
</dd></dl>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">h</span> = <span class="ruby-identifier">collate_materials</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">pages</span>)
<span class="ruby-identifier">h</span> <span class="ruby-comment"># =&gt; {</span>
  <span class="ruby-comment"># &quot;assembly/velvet-assembly&quot; =&gt; {</span>
  <span class="ruby-comment">#  &quot;topic&quot; =&gt; &quot;assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;topic_name&quot; =&gt; &quot;assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;material&quot; =&gt; &quot;assembly/velvet-assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;tutorial_name&quot; =&gt; &quot;velvet-assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;dir&quot; =&gt; &quot;topics/assembly/tutorials/velvet-assembly&quot;,</span>
  <span class="ruby-comment">#  &quot;resources&quot; =&gt; [</span>
  <span class="ruby-comment">#    {</span>
  <span class="ruby-comment">#    &quot;type&quot; =&gt; &quot;slides&quot;,</span>
  <span class="ruby-comment">#    &quot;url&quot; =&gt; &quot;/topics/assembly/tutorials/velvet-assembly/slides.html&quot;,</span>
  <span class="ruby-comment">#    &quot;title&quot; =&gt; &quot;Slides&quot;,</span>
  <span class="ruby-comment">#    &quot;priority&quot; =&gt; 1</span>
  <span class="ruby-comment">#    },</span>
  <span class="ruby-comment">#    {</span>
  <span class="ruby-comment">#    &quot;type&quot; =&gt; &quot;tutorial&quot;,</span>
  <span class="ruby-comment">#    &quot;url&quot; =&gt; &quot;/topics/assembly/tutorials/velvet-assembly/tutorial.html&quot;,</span>
  <span class="ruby-comment">#    &quot;title&quot; =&gt; &quot;Tutorial&quot;,</span>
  <span class="ruby-comment">#    &quot;priority&quot; =&gt; 2</span>
  <span class="ruby-comment">#    }</span>
  <span class="ruby-comment">#   ]</span>
  <span class="ruby-comment">#  }</span>
</pre>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="collate_materials-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 365</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">collate_materials</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">pages</span>)
  <span class="ruby-comment"># In order to speed up queries later, we&#39;ll store a set of &quot;interesting&quot;</span>
  <span class="ruby-comment"># pages (i.e. things that are under `topic_name`)</span>
  <span class="ruby-identifier">shortlinks</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;shortlinks&#39;</span>]
  <span class="ruby-identifier">shortlinks_reversed</span> = <span class="ruby-identifier">shortlinks</span>[<span class="ruby-string">&#39;id&#39;</span>].<span class="ruby-identifier">invert</span>

  <span class="ruby-identifier">interesting</span> = {}
  <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Skip anything outside of topics.</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">url</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;/topics/&#39;</span>)

    <span class="ruby-comment"># Extract the material metadata based on the path</span>
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;url&#39;</span>] = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">url</span>
    <span class="ruby-identifier">material_meta</span> = <span class="ruby-identifier">annotate_path</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;layout&#39;</span>])

    <span class="ruby-comment"># If unannotated then we want to skip this material.</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">material_meta</span>.<span class="ruby-identifier">nil?</span>

    <span class="ruby-identifier">mk</span> = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;material&#39;</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">interesting</span>.<span class="ruby-identifier">key?</span> <span class="ruby-identifier">mk</span>
      <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>] = <span class="ruby-identifier">material_meta</span>.<span class="ruby-identifier">dup</span>
      <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;type&#39;</span>) <span class="ruby-comment"># Remove the type since it&#39;s specific, not generic</span>
      <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>][<span class="ruby-string">&#39;resources&#39;</span>] = []
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>] = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>]
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dir&#39;</span>] = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;dir&#39;</span>]
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;short_id&#39;</span>] = <span class="ruby-identifier">shortlinks_reversed</span>[<span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;url&#39;</span>]]
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;symlink&#39;</span>] = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;symlink&#39;</span>]

    <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>][<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">push</span>([<span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;type&#39;</span>], <span class="ruby-identifier">page</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">interesting</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-enumerate_topics" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-enumerate_topics" title="Link to this method">
                            <span class="method-name">enumerate_topics</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>This function returns a list of all the topics that are available. Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>The topic objects themselves</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="enumerate_topics-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">enumerate_topics</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">list_topics_h</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">values</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-extract_workflow_tool_list" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-extract_workflow_tool_list" title="Link to this method">
                            <span class="method-name">extract_workflow_tool_list</span>
                            <span class="method-args">(data)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Extract the list of tools used in a workflow Params:</p>
<dl class="rdoc-list note-list"><dt><code>data</code></dt>
<dd>
<p>The Galaxy Workflow JSON data, parsed</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>The list of tool IDs</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="extract_workflow_tool_list-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">extract_workflow_tool_list</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">out</span> = <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tool&#39;</span> }.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>] }.<span class="ruby-identifier">compact</span>
  <span class="ruby-identifier">out</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
           <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;subworkflow&#39;</span>
         <span class="ruby-keyword">end</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">extract_workflow_tool_list</span>(<span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;subworkflow&#39;</span>]) }
  <span class="ruby-identifier">out</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-fetch_tutorial_material" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-fetch_tutorial_material" title="Link to this method">
                            <span class="method-name">fetch_tutorial_material</span>
                            <span class="method-args">(site, topic_name, tutorial_name)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Fetch a specific tutorial material by topic and tutorial name Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>topic_name</code></dt>
<dd>
<p>The name of the topic</p>
</dd><dt><code>tutorial_name</code></dt>
<dd>
<p>The name of the tutorial</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code></dt>
<dd>
<p>The tutorial material</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="fetch_tutorial_material-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fetch_tutorial_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>, <span class="ruby-identifier">tutorial_name</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">topic_name</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">fill_cache</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic_name</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Cannot fetch tutorial material for #{topic_name}&quot;</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic_name</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">tutorial_name</span> }[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-fill_cache" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-fill_cache" title="Link to this method">
                            <span class="method-name">fill_cache</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Fill the cache with all the topics if it hasn’t been done already. Safe to be called multiple times. Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns: <code>nil</code></p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="fill_cache-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fill_cache</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;cache_topic_filter&#39;</span>)

  <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&#39;[GTN/TopicFilter] Begin Cache Prefill&#39;</span>
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>] = {}

  <span class="ruby-comment"># For each topic</span>
  <span class="ruby-identifier">list_topics</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">topic</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic</span>] = <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&#39;[GTN/TopicFilter] End Cache Prefill&#39;</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-filter_by_tag" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-filter_by_tag" title="Link to this method">
                            <span class="method-name">filter_by_tag</span>
                            <span class="method-args">(site, topic_name)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="filter_by_tag-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1089</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
  <span class="ruby-comment"># Here we make a (cached) call to load materials into memory and sort them</span>
  <span class="ruby-comment"># properly.</span>
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)

  <span class="ruby-comment"># Select those with that topic ID or that tag</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">topic_name</span> }
  <span class="ruby-identifier">resource_pages</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">topic_name</span>) }

  <span class="ruby-comment"># The complete resources we&#39;ll return is the introduction slides first</span>
  <span class="ruby-comment"># (EDIT: not anymore, we rely on prioritisation!)</span>
  <span class="ruby-comment"># and then the rest of the pages.</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;priority&#39;</span>, <span class="ruby-value">1</span>) }

  <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error? Could not find any relevant tagged pages for #{topic_name}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">resource_pages</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-filter_by_topic" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-filter_by_topic" title="Link to this method">
                            <span class="method-name">filter_by_topic</span>
                            <span class="method-args">(site, topic_name)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="filter_by_topic-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1068</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
  <span class="ruby-comment"># Here we make a (cached) call to load materials into memory and sort them</span>
  <span class="ruby-comment"># properly.</span>
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)

  <span class="ruby-comment"># Select out the materials by topic:</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">topic_name</span> }

  <span class="ruby-comment"># If there is nothing with that topic name, try generating it by tags.</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">topic_name</span>) } <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-comment"># The complete resources we&#39;ll return is the introduction slides first</span>
  <span class="ruby-comment"># (EDIT: not anymore, we rely on prioritisation!)</span>
  <span class="ruby-comment"># and then the rest of the pages.</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;priority&#39;</span>, <span class="ruby-value">1</span>) }

  <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error? Could not find any relevant pages for #{topic_name}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">resource_pages</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-filter_by_topic_subtopic" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-filter_by_topic_subtopic" title="Link to this method">
                            <span class="method-name">filter_by_topic_subtopic</span>
                            <span class="method-args">(site, topic_name, subtopic_id)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Filter a list of materials by topic and subtopic.</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="filter_by_topic_subtopic-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1110</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">filter_by_topic_subtopic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>, <span class="ruby-identifier">subtopic_id</span>)
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)

  <span class="ruby-comment"># Select out materials with the correct subtopic</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;subtopic&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">subtopic_id</span> }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error? Could not find any relevant pages for #{topic_name} / #{subtopic_id}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">resource_pages</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-get_posts" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-get_posts" title="Link to this method">
                            <span class="method-name">get_posts</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Get the list of posts from the site Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>The list of posts</p>
</dd></dl>

<p>This is a transition period function that can later be removed. It is added because with the jekyll version we’re using, site.posts is an iterable in prod+dev (_config-dev.yml) modes, however! If we access site.posts.docs in prod it’s fine, while in dev mode, site.posts claims to be an Array (rather than I guess a ‘posts’ object with a docs method). So we check if it has docs and use that, otherwise just site.posts should be iterable.</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="get_posts-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 324</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_posts</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-comment"># Handle the transition period</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:docs</span>)
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">docs</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">posts</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-get_version" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-get_version" title="Link to this method">
                            <span class="method-name">get_version</span>
                            <span class="method-args">(tool)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Get the version of a tool. Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>tool</code></dt>
<dd>
<p>A tool string</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code></dt>
<dd>
<p>The version of the tool.</p>
</dd></dl>

<p>Examples: <a href="TopicFilter.html#method-c-get_version"><code>get_version</code></a>(“toolshed.g2.bx.psu.edu/repos/galaxyp/regex_find_replace/regex1/1.0.0”) =&gt; “1.0.0”</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="get_version-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1165</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_version</span>(<span class="ruby-identifier">tool</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tool</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&#39;/&#39;</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span>
    <span class="ruby-identifier">tool</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)[<span class="ruby-value">-1</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tool</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-git_log" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-git_log" title="Link to this method">
                            <span class="method-name">git_log</span>
                            <span class="method-args">(wf_path)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>(PRODUCTION ONLY) Extract a log of commits (hash, timestamp, message) for commits to a specific path</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>wf_path</code></dt>
<dd>
<p>Path to a file</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>An array of {‘hash’ =&gt; …, ‘unix’ =&gt; 1230, ‘message’ =&gt; ‘I did something’, ‘short_hash’ =&gt; … }</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="git_log-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 560</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">git_log</span>(<span class="ruby-identifier">wf_path</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">env</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;production&#39;</span>
    <span class="ruby-keyword">return</span> []
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">getset</span>(<span class="ruby-identifier">wf_path</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;shellwords&#39;</span>

    <span class="ruby-identifier">commits</span> = <span class="ruby-node">%x[git log --format=&quot;%H %at %s&quot; #{Shellwords.escape(wf_path)}]</span>
      .<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)
      .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; &#39;</span>, <span class="ruby-value">3</span>) }
      .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> { <span class="ruby-string">&#39;hash&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">0</span>], <span class="ruby-string">&#39;unix&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">1</span>], <span class="ruby-string">&#39;message&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">2</span>], <span class="ruby-string">&#39;short_hash&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">8</span>] } }

    <span class="ruby-identifier">commits</span>.<span class="ruby-identifier">map</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">c</span>[<span class="ruby-string">&#39;num&#39;</span>] = <span class="ruby-identifier">commits</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">i</span>
      <span class="ruby-identifier">c</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-graph_dot" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-graph_dot" title="Link to this method">
                            <span class="method-name">graph_dot</span>
                            <span class="method-args">(wf)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Build a DOT graph for a given tutorial file.</p>

<p>TODO: extract into own module along with mermaid.</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>wf</code></dt>
<dd>
<p>The Galaxy Workflow JSON representation</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code></dt>
<dd>
<p>A DOT graph of the workflow.</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="graph_dot-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 495</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">graph_dot</span>(<span class="ruby-identifier">wf</span>)
  <span class="ruby-comment"># digraph test {</span>
  <span class="ruby-comment">#   0[shape=box,style=filled,color=lightblue,label=&quot;ℹ️ Input Dataset\nBionano_dataset&quot;]</span>
  <span class="ruby-comment">#   1[shape=box,style=filled,color=lightblue,label=&quot;ℹ️ Input Dataset\nHi-C_dataset_R&quot;]</span>
  <span class="ruby-comment">#   3 -&gt; 6 [label=&quot;output&quot;]</span>
  <span class="ruby-comment">#   7[shape=box,label=&quot;Busco&quot;]</span>
  <span class="ruby-comment">#   4 -&gt; 7 [label=&quot;out_fa&quot;]</span>
  <span class="ruby-comment">#   8[shape=box,label=&quot;Busco&quot;]</span>
  <span class="ruby-comment">#   5 -&gt; 8 [label=&quot;out_fa&quot;]</span>

  <span class="ruby-identifier">statements</span> = [
    <span class="ruby-string">&#39;node [fontname=&quot;Atkinson Hyperlegible&quot;, shape=box, color=white,style=filled,color=peachpuff,margin=&quot;0.2,0.2&quot;];&#39;</span>,
    <span class="ruby-string">&#39;edge [fontname=&quot;Atkinson Hyperlegible&quot;];&#39;</span>,
  ]
  <span class="ruby-identifier">wf</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">each_key</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">step</span> = <span class="ruby-identifier">wf</span>[<span class="ruby-string">&#39;steps&#39;</span>][<span class="ruby-identifier">id</span>]
    <span class="ruby-identifier">chosen_label</span> = <span class="ruby-identifier">mermaid_safe_label</span>(<span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;label&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;name&#39;</span>])

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;type&#39;</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;data_collection_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[color=lightblue,label=\&quot;ℹ️ Input Collection\\n#{chosen_label}\&quot;]&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;data_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[color=lightblue,label=\&quot;ℹ️ Input Dataset\\n#{chosen_label}\&quot;]&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;parameter_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[color=lightgreen,label=\&quot;ℹ️ Input Parameter\\n#{chosen_label}\&quot;]&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;subworkflow&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[color=lightcoral,label=\&quot;🛠️ Subworkflow\\n#{chosen_label}\&quot;]&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[label=\&quot;#{chosen_label}\&quot;]&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">step</span> = <span class="ruby-identifier">wf</span>[<span class="ruby-string">&#39;steps&#39;</span>][<span class="ruby-identifier">id</span>]
    <span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;input_connections&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># if v is a list</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
        <span class="ruby-identifier">v</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v2</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{v2[&#39;id&#39;]} -&gt; #{id} [label=\&quot;#{mermaid_safe_label(v2[&#39;output_name&#39;])}\&quot;]&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{v[&#39;id&#39;]} -&gt; #{id} [label=\&quot;#{mermaid_safe_label(v[&#39;output_name&#39;])}\&quot;]&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    (<span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;workflow_outputs&#39;</span>] <span class="ruby-operator">||</span> [])
      .<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">wo</span><span class="ruby-operator">|</span> <span class="ruby-identifier">wo</span>[<span class="ruby-string">&#39;label&#39;</span>].<span class="ruby-identifier">nil?</span> }
      .<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wo</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">wo</span>[<span class="ruby-string">&#39;uuid&#39;</span>] = <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">uuid</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">wo</span>[<span class="ruby-string">&#39;uuid&#39;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">wo</span>
      <span class="ruby-keyword">end</span>
      .<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wo</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;k#{wo[&#39;uuid&#39;].gsub(&#39;-&#39;, &#39;&#39;)}[color=lightseagreen,label=\&quot;Output\\n#{wo[&#39;label&#39;]}\&quot;]&quot;</span>
        <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id} -&gt; k#{wo[&#39;uuid&#39;].gsub(&#39;-&#39;, &#39;&#39;)}&quot;</span>
      <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-string">&quot;digraph main {\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;  #{q}&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n}&quot;</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-identify_contributors" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-identify_contributors" title="Link to this method">
                            <span class="method-name">identify_contributors</span>
                            <span class="method-args">(materials, site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Get a list of contributors for a list of materials Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>materials</code></dt>
<dd>
<p>An array of materials</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>An array of individual contributors as strings.</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="identify_contributors-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1129</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">identify_contributors</span>(<span class="ruby-identifier">materials</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;materials&#39;</span>] }.<span class="ruby-identifier">flatten</span>
    <span class="ruby-comment"># Not 100% sure why this flatten is needed? Probably due to the map over hash</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mat</span><span class="ruby-operator">|</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_contributors</span>(<span class="ruby-identifier">mat</span>) }
    .<span class="ruby-identifier">flatten</span>
    .<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">person?</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">c</span>) }
    .<span class="ruby-identifier">uniq</span>
    .<span class="ruby-identifier">shuffle</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-identify_funders_and_grants" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-identify_funders_and_grants" title="Link to this method">
                            <span class="method-name">identify_funders_and_grants</span>
                            <span class="method-args">(materials, site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Get a list of funders for a list of materials Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>materials</code></dt>
<dd>
<p>An array of materials</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>An array of funder (organisations that provided support) IDs as strings.</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="identify_funders_and_grants-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1146</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">identify_funders_and_grants</span>(<span class="ruby-identifier">materials</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;materials&#39;</span>] }.<span class="ruby-identifier">flatten</span>
    <span class="ruby-comment"># Not 100% sure why this flatten is needed? Probably due to the map over hash</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mat</span><span class="ruby-operator">|</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Contributors</span>.<span class="ruby-identifier">get_all_funding</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">mat</span>) }
    .<span class="ruby-identifier">flatten</span>
    .<span class="ruby-identifier">uniq</span>
    .<span class="ruby-identifier">shuffle</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-list_all_materials" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-list_all_materials" title="Link to this method">
                            <span class="method-name">list_all_materials</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>This is a helper function to get all the materials in a site.</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="list_all_materials-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1043</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_all_materials</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-list_all_tags" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-list_all_tags" title="Link to this method">
                            <span class="method-name">list_all_tags</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>List every tag used across all materials. This is used to generate the tag cloud.</p>

<p>Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object, used to get the list of pages.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>An array of strings, each string is a tag. (sorted and unique)</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="list_all_tags-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1063</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_all_tags</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)
  (<span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> [] }.<span class="ruby-identifier">flatten</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">list_topics</span>(<span class="ruby-identifier">site</span>)).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-list_materials_by_tool" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-list_materials_by_tool" title="Link to this method">
                            <span class="method-name">list_materials_by_tool</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>List materials by tool Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object, used to get the list of pages.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code></dt>
<dd>
<p>A hash of tool_id =&gt; {</p>
</dd></dl>

<pre>&quot;tool_id&quot; =&gt; [tool_id, version],
&quot;tutorials&quot; =&gt; [tutorial_id, tutorial_title, topic_title, tutorial_url]</pre>

<p>}</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="list_materials_by_tool-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1199</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_materials_by_tool</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">tool_map</span> = {}

  <span class="ruby-identifier">list_all_materials</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">m</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;tools&#39;</span>, []).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tool</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">sid</span> = <span class="ruby-identifier">short_tool</span>(<span class="ruby-identifier">tool</span>)
      <span class="ruby-identifier">tool_map</span>[<span class="ruby-identifier">sid</span>] = { <span class="ruby-string">&#39;tool_id&#39;</span> <span class="ruby-operator">=&gt;</span> [], <span class="ruby-string">&#39;tutorials&#39;</span> <span class="ruby-operator">=&gt;</span> [] } <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tool_map</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">sid</span>)

      <span class="ruby-identifier">tool_map</span>[<span class="ruby-identifier">sid</span>][<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">push</span>([<span class="ruby-identifier">tool</span>, <span class="ruby-identifier">get_version</span>(<span class="ruby-identifier">tool</span>)])
      <span class="ruby-identifier">tool_map</span>[<span class="ruby-identifier">sid</span>][<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">push</span>([
                                        <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;id&#39;</span>], <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;title&#39;</span>], <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]][<span class="ruby-string">&#39;title&#39;</span>], <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;url&#39;</span>]
                                      ])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Uniqueify/sort</span>
  <span class="ruby-identifier">t</span> = <span class="ruby-identifier">tool_map</span>.<span class="ruby-identifier">to_h</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">sort_by!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k2</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k2</span>[<span class="ruby-value">1</span>] }
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">reverse!</span>

    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">sort!</span>
    [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Order by most popular tool</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">length</span> }.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">to_h</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-list_materials_structured" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-list_materials_structured" title="Link to this method">
                            <span class="method-name">list_materials_structured</span>
                            <span class="method-args">(site, topic_name)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>This function returns a list of all the materials that are available for a specific topic, but this time in a structured manner Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>topic_name</code></dt>
<dd>
<p>The name of the topic</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code></dt>
<dd>
<p>The subtopics and their materials</p>
</dd></dl>

<p>Example:</p>

<pre>{
 &quot;intro&quot; =&gt; {
   &quot;subtopic&quot; =&gt; {&quot;title&quot; =&gt; &quot;Introduction&quot;, &quot;description&quot; =&gt; &quot;Introduction to the topic&quot;, &quot;id&quot; =&gt; &quot;intro&quot;},
   &quot;materials&quot; =&gt; [
     ...
   ]
 },
 &quot;__OTHER__&quot; =&gt; {
   &quot;subtopic&quot; =&gt; {&quot;title&quot; =&gt; &quot;Other&quot;, &quot;description&quot; =&gt; &quot;Other materials&quot;, &quot;id&quot; =&gt; &quot;__OTHER__&quot;},
   &quot;materials&quot; =&gt; [.. ]
 }
]</pre>

<p>This method is built with the idea to replace the “topic_filter” command, and instead of returning semi-structured data, we will immediately return fully structured data for a specific “topic_name” query, like, “admin”</p>

<p>Instead of returning a flat list of tutorials, instead we’ll structure them properly in subtopics (if they exist) or return the flat list otherwise.</p>

<p>This will let us generate new “views” into the tutorial lists, having them arranged in new and exciting ways.</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="list_materials_structured-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 111</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_materials_structured</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)

  <span class="ruby-identifier">fill_cache</span>(<span class="ruby-identifier">site</span>)

  <span class="ruby-comment"># Here we want to either return data structured around subtopics</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;tag_based&#39;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>].<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;subtopics&#39;</span>)
    <span class="ruby-comment"># We&#39;ll construct a new hash of subtopic =&gt; tutorials</span>
    <span class="ruby-identifier">out</span> = {}
    <span class="ruby-identifier">seen_ids</span> = []
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;subtopics&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subtopic</span>, <span class="ruby-identifier">_v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">specific_resources</span> = <span class="ruby-identifier">filter_by_topic_subtopic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>, <span class="ruby-identifier">subtopic</span>[<span class="ruby-string">&#39;id&#39;</span>])
      <span class="ruby-identifier">out</span>[<span class="ruby-identifier">subtopic</span>[<span class="ruby-string">&#39;id&#39;</span>]] = {
        <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">subtopic</span>,
        <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">specific_resources</span>
      }
      <span class="ruby-identifier">seen_ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">specific_resources</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>] }
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># And we&#39;ll have this __OTHER__ subtopic for any tutorials that weren&#39;t</span>
    <span class="ruby-comment"># in a subtopic.</span>
    <span class="ruby-identifier">all_topics_for_tutorial</span> = <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
    <span class="ruby-identifier">out</span>[<span class="ruby-string">&#39;__OTHER__&#39;</span>] = {
      <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Other&#39;</span>, <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Assorted Tutorials&#39;</span>, <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;other&#39;</span> },
      <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">all_topics_for_tutorial</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">seen_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>]) }
    }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;tag_based&#39;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>].<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;subtopics&#39;</span>)
    <span class="ruby-identifier">out</span> = {}
    <span class="ruby-identifier">seen_ids</span> = []
    <span class="ruby-identifier">tn</span> = <span class="ruby-identifier">topic_name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;by_tag_&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tn</span>)

    <span class="ruby-comment"># For each subtopics</span>
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;subtopics&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subtopic</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># Find matching tag-based tutorials in our filtered-by-tag materials</span>
      <span class="ruby-identifier">specific_resources</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">subtopic</span>[<span class="ruby-string">&#39;id&#39;</span>]) }
      <span class="ruby-identifier">out</span>[<span class="ruby-identifier">subtopic</span>[<span class="ruby-string">&#39;id&#39;</span>]] = {
        <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">subtopic</span>,
        <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">specific_resources</span>
      }
      <span class="ruby-identifier">seen_ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">specific_resources</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>] }
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tn</span>)
    <span class="ruby-identifier">out</span>[<span class="ruby-string">&#39;__OTHER__&#39;</span>] = {
      <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Other&#39;</span>, <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Assorted Tutorials&#39;</span>, <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;other&#39;</span> },
      <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">seen_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>]) }
    }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;tag_based&#39;</span>] <span class="ruby-comment"># Tag based Topic</span>
    <span class="ruby-comment"># We&#39;ll construct a new hash of subtopic(parent topic) =&gt; tutorials</span>
    <span class="ruby-identifier">out</span> = {}
    <span class="ruby-identifier">seen_ids</span> = []
    <span class="ruby-identifier">tn</span> = <span class="ruby-identifier">topic_name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;by_tag_&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tn</span>)

    <span class="ruby-comment"># Which topics are represented in those materials?</span>
    <span class="ruby-identifier">seen_topics</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] }.<span class="ruby-identifier">sort</span>

    <span class="ruby-comment"># Treat them like subtopics, but fake subtopics.</span>
    <span class="ruby-identifier">seen_topics</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">parent_topic</span>, <span class="ruby-identifier">_v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">specific_resources</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">parent_topic</span> }
      <span class="ruby-identifier">out</span>[<span class="ruby-identifier">parent_topic</span>] = {
        <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parent_topic</span>, <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">parent_topic</span>][<span class="ruby-string">&#39;title&#39;</span>], <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span> },
        <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">specific_resources</span>
      }
      <span class="ruby-identifier">seen_ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">specific_resources</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>] }
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># And we&#39;ll have this __OTHER__ subtopic for any tutorials that weren&#39;t</span>
    <span class="ruby-comment"># in a subtopic.</span>
    <span class="ruby-identifier">all_topics_for_tutorial</span> = <span class="ruby-identifier">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tn</span>)
    <span class="ruby-identifier">out</span>[<span class="ruby-string">&#39;__OTHER__&#39;</span>] = {
      <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Other&#39;</span>, <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Assorted Tutorials&#39;</span>, <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;other&#39;</span> },
      <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">all_topics_for_tutorial</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">seen_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>]) }
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Or just the list (Jury is still out on this one, should it really be a</span>
    <span class="ruby-comment"># flat list? Or in this identical structure.)</span>
    <span class="ruby-identifier">out</span> = {
      <span class="ruby-string">&#39;__FLAT__&#39;</span> <span class="ruby-operator">=&gt;</span> {
        <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,
        <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
      }
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Cleanup empty sections</span>
  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;__OTHER__&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">out</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;__OTHER__&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">out</span>[<span class="ruby-string">&#39;__OTHER__&#39;</span>][<span class="ruby-string">&#39;materials&#39;</span>].<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;materials&#39;</span>].<span class="ruby-identifier">sort_by!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">m</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;priority&#39;</span>, <span class="ruby-value">1</span>), <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;title&#39;</span>]] }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">out</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-list_topics" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-list_topics" title="Link to this method">
                            <span class="method-name">list_topics</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>This function returns a list of all the topics that are available. Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>The list of topics</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="list_topics-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 24</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_topics</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">list_topics_h</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">keys</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-list_topics_h" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-list_topics_h" title="Link to this method">
                            <span class="method-name">list_topics_h</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="list_topics_h-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_topics_h</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;editorial_board&#39;</span>) }
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-list_videos" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-list_videos" title="Link to this method">
                            <span class="method-name">list_videos</span>
                            <span class="method-args">(site)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>This is a helper function to get materials with automated videos.</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="list_videos-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1049</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_videos</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)
  <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;video&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> }
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-mermaid" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-mermaid" title="Link to this method">
                            <span class="method-name">mermaid</span>
                            <span class="method-args">(wf)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Build a Mermaid.js compatible graph of a given Galaxy Workflow</p>

<p>TODO: extract into own module along with DOT&gt;</p>

<p>Params:</p>
<dl class="rdoc-list note-list"><dt><code>wf</code></dt>
<dd>
<p>The Galaxy Workflow JSON representation</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code></dt>
<dd>
<p>A Mermaid.js compatible graph of the workflow.</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="mermaid-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 422</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">mermaid</span>(<span class="ruby-identifier">wf</span>)
  <span class="ruby-comment"># We&#39;re converting it to Mermaid.js</span>
  <span class="ruby-comment"># flowchart TD</span>
  <span class="ruby-comment">#     A[Start] --&gt; B{Is it?}</span>
  <span class="ruby-comment">#     B -- Yes --&gt; C[OK]</span>
  <span class="ruby-comment">#     C --&gt; D[Rethink]</span>
  <span class="ruby-comment">#     D --&gt; B</span>
  <span class="ruby-comment">#     B -- No ----&gt; E[End]</span>

  <span class="ruby-identifier">statements</span> = []
  <span class="ruby-identifier">wf</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">each_key</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">step</span> = <span class="ruby-identifier">wf</span>[<span class="ruby-string">&#39;steps&#39;</span>][<span class="ruby-identifier">id</span>]
    <span class="ruby-identifier">chosen_label</span> = <span class="ruby-identifier">mermaid_safe_label</span>(<span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;label&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;name&#39;</span>])

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;type&#39;</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;data_collection_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[\&quot;ℹ️ Input Collection\\n#{chosen_label}\&quot;];&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;data_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[\&quot;ℹ️ Input Dataset\\n#{chosen_label}\&quot;];&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;parameter_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[\&quot;ℹ️ Input Parameter\\n#{chosen_label}\&quot;];&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;subworkflow&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[\&quot;🛠️ Subworkflow\\n#{chosen_label}\&quot;];&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id}[\&quot;#{chosen_label}\&quot;];&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;type&#39;</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;data_collection_input&#39;</span>, <span class="ruby-string">&#39;data_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;style #{id} stroke:#2c3143,stroke-width:4px;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;parameter_input&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;style #{id} fill:#ded,stroke:#393,stroke-width:4px;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;subworkflow&#39;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;style #{id} fill:#edd,stroke:#900,stroke-width:4px;&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">step</span> = <span class="ruby-identifier">wf</span>[<span class="ruby-string">&#39;steps&#39;</span>][<span class="ruby-identifier">id</span>]
    <span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;input_connections&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># if v is a list</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
        <span class="ruby-identifier">v</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v2</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{v2[&#39;id&#39;]} --&gt;|#{mermaid_safe_label(v2[&#39;output_name&#39;])}| #{id};&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{v[&#39;id&#39;]} --&gt;|#{mermaid_safe_label(v[&#39;output_name&#39;])}| #{id};&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    (<span class="ruby-identifier">step</span>[<span class="ruby-string">&#39;workflow_outputs&#39;</span>] <span class="ruby-operator">||</span> [])
      .<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">wo</span><span class="ruby-operator">|</span> <span class="ruby-identifier">wo</span>[<span class="ruby-string">&#39;label&#39;</span>].<span class="ruby-identifier">nil?</span> }
      .<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wo</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">wo</span>[<span class="ruby-string">&#39;uuid&#39;</span>] = <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">uuid</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">wo</span>[<span class="ruby-string">&#39;uuid&#39;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">wo</span>
      <span class="ruby-keyword">end</span>
      .<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wo</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{wo[&#39;uuid&#39;]}[\&quot;Output\\n#{wo[&#39;label&#39;]}\&quot;];&quot;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;#{id} --&gt; #{wo[&#39;uuid&#39;]};&quot;</span>
      <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">append</span> <span class="ruby-node">&quot;style #{wo[&#39;uuid&#39;]} stroke:#2c3143,stroke-width:4px;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-string">&quot;flowchart TD\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;  #{q}&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-mermaid_safe_label" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-mermaid_safe_label" title="Link to this method">
                            <span class="method-name">mermaid_safe_label</span>
                            <span class="method-args">(label)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Make a label safe for use in mermaid (without ()[]“‘)</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="mermaid_safe_label-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 405</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">mermaid_safe_label</span>(<span class="ruby-identifier">label</span>)
  (<span class="ruby-identifier">label</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>)
    .<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;(&#39;</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;)&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
    .<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;[&#39;</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;]&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
    .<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;&quot;&#39;</span>, <span class="ruby-string">&#39;”&#39;</span>) <span class="ruby-comment"># We accept that this is not perfectly correct.</span>
    .<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;&#39;&quot;</span>, <span class="ruby-string">&#39;’&#39;</span>)
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-process_pages" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-process_pages" title="Link to this method">
                            <span class="method-name">process_pages</span>
                            <span class="method-args">(site, pages)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="process_pages-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 998</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">pages</span>)
  <span class="ruby-comment"># eww.</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_processed_pages&#39;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;cache_processed_pages&#39;</span>)

  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">collate_materials</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">pages</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">resolve_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">v</span>) }
  <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&#39;[GTN/TopicFilter] Filling Materials Cache&#39;</span>
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_processed_pages&#39;</span>] = <span class="ruby-identifier">materials</span>

  <span class="ruby-comment"># Prepare short URLs</span>
  <span class="ruby-identifier">shortlinks</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;shortlinks&#39;</span>]
  <span class="ruby-identifier">mappings</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = [] }

  <span class="ruby-identifier">shortlinks</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">kp</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">shortlinks</span>[<span class="ruby-identifier">kp</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">v</span>].<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;/short/#{k}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Update the materials with their short IDs + redirects</span>
  <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Set the short id on the material</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>]
      <span class="ruby-comment"># Initialise redirects if it wasn&#39;t set</span>
      <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;redirect_from&#39;</span>)
      <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span>])
      <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;redirect_from&#39;</span>)

      <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span>])
      <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Same for news</span>
  <span class="ruby-identifier">get_posts</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Set the short id on the material</span>
    <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;redirect_from&#39;</span>)
    <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span>])
    <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">uniq!</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">materials</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-resolve_material" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-resolve_material" title="Link to this method">
                            <span class="method-name">resolve_material</span>
                            <span class="method-args">(site, material)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Resolve a material from a given collated material. What does that entail? A LOT.</p>

<p>Given a collated material, e.g.</p>

<pre class="ruby"><span class="ruby-identifier">material</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">TopicFilter</span>.<span class="ruby-identifier">collate_materials</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)[<span class="ruby-string">&#39;proteomics/database-handling&#39;</span>]
<span class="ruby-identifier">material</span> <span class="ruby-comment"># =&gt;</span>
    <span class="ruby-comment"># {&quot;topic&quot;=&gt;&quot;proteomics&quot;,</span>
    <span class="ruby-comment">#  &quot;topic_name&quot;=&gt;&quot;proteomics&quot;,</span>
    <span class="ruby-comment">#  &quot;material&quot;=&gt;&quot;proteomics/database-handling&quot;,</span>
    <span class="ruby-comment">#  &quot;tutorial_name&quot;=&gt;&quot;database-handling&quot;,</span>
    <span class="ruby-comment">#  &quot;dir&quot;=&gt;&quot;topics/proteomics/tutorials/database-handling&quot;,</span>
    <span class="ruby-comment">#  &quot;resources&quot;=&gt;</span>
    <span class="ruby-comment">#   [[&quot;workflow&quot;, #&lt;Jekyll::Page @relative_path=&quot;topics/proteomics/tutorials/database-handling/workflows/index.md&quot;&gt;],</span>
    <span class="ruby-comment">#    [&quot;tour&quot;, #&lt;Jekyll::Page @relative_path=&quot;topics/proteomics/tutorials/database-handling/tours/proteomics-database-handling-mycroplasma.yaml&quot;&gt;],</span>
    <span class="ruby-comment">#    [&quot;tour&quot;, #&lt;Jekyll::Page @relative_path=&quot;topics/proteomics/tutorials/database-handling/tours/proteomics-database-handling.yaml&quot;&gt;],</span>
    <span class="ruby-comment">#    [&quot;tutorial&quot;, #&lt;Jekyll::Page @relative_path=&quot;topics/proteomics/tutorials/database-handling/tutorial.md&quot;&gt;],</span>
    <span class="ruby-comment">#    [&quot;recordings&quot;, #&lt;Jekyll::PageWithoutAFile @relative_path=&quot;topics/proteomics/tutorials/database-handling/recordings/index.html&quot;&gt;],</span>
    <span class="ruby-comment">#    [&quot;workflow&quot;, #&lt;Jekyll::PageWithoutAFile @relative_path=&quot;topics/proteomics/tutorials/database-handling/workflows/wf_database-handling.html&quot;&gt;],</span>
    <span class="ruby-comment">#    [&quot;workflow&quot;, #&lt;Jekyll::PageWithoutAFile @relative_path=&quot;topics/proteomics/tutorials/database-handling/workflows/wf_database-handling_mycoplasma.html&quot;&gt;]]}</span>
</pre>

<p>We can then choose to ‘resolve’ that material, i.e. collect all of the relevant information that is needed for it to really be useful. This includes things like tools, workflows, etc. Everything is packed into a highly annotated ‘material’ <a href="../Hash.html"><code>Hash</code></a>.</p>

<p>You might look below and say “Wow that is ridiculously unnecessarily complicated”, or, maybe not. But either way, this is what is required to display a full ‘learning material’ on the GTN, and all of the metadata that goes into it.</p>

<p>Some of the highlights are:</p>
<ul><li>
<p>learning resource metadata (taken from tutorial if it exists, otherwise, from the slides)</p>
</li><li>
<p>short ID</p>
</li><li>
<p>topic information (topic name/ topic_id)</p>
</li><li>
<p>any javascript requirements</p>
</li><li>
<p>All associated workflows, and metadata about those workflows (tests, features used, associated test results, mermaid and dot graphs, associated tools, inputs and outputs.)</p>
</li><li>
<p><code>ref</code>, <code>ref_tutorials</code>, <code>ref_slides</code> that point to the actual <a href="../Jekyll.html"><code>Jekyll</code></a> pages, in case you need those.</p>
</li><li>
<p>api URL</p>
</li><li>
<p>tools (discovered from the tutorial text + workflows)</p>
</li><li>
<p>a list of supported servers for easy display (exact and inexact matches)</p>
</li><li>
<p>a matrix of which servers support which versions of those tools, for a full compatibility table (used on maintainer page.)</p>
</li><li>
<p>requisite metdata for an admin to install these tools</p>

<pre>resource = Gtn::TopicFilter.collate_materials(site, site.pages)[&#39;proteomics/database-handling&#39;]
material = Gtn::TopicFilter.resolve_material(site, resource)
material # =&gt;
{&quot;layout&quot;=&gt;&quot;tutorial_hands_on&quot;,
 &quot;title&quot;=&gt;&quot;Protein FASTA Database Handling&quot;,
 &quot;edam_ontology&quot;=&gt;[&quot;topic_0121&quot;],
 &quot;zenodo_link&quot;=&gt;&quot;&quot;,
 &quot;level&quot;=&gt;&quot;Introductory&quot;,
 &quot;questions&quot;=&gt;[&quot;How to download protein FASTA databases of a certain organism?&quot;, &quot;How to download a contaminant database?&quot;, &quot;How to create a decoy database?&quot;, &quot;How to combine databases?&quot;],
 &quot;objectives&quot;=&gt;[&quot;Creation of a protein FASTA database ready for use with database search algorithms.&quot;],
 &quot;time_estimation&quot;=&gt;&quot;30m&quot;,
 &quot;key_points&quot;=&gt;
  [&quot;There are several types of Uniprot databases.&quot;,
   &quot;Search databases should always include possible contaminants.&quot;,
   &quot;For analyzing cell culture or organic samples, search databases should include mycoplasma databases.&quot;,
   &quot;Some peptide search engines depend on decoys to calculate the FDR.&quot;],
 &quot;contributors&quot;=&gt;[&quot;stortebecker&quot;, &quot;bgruening&quot;],
 &quot;subtopic&quot;=&gt;&quot;id-quant&quot;,
 &quot;tags&quot;=&gt;[&quot;DDA&quot;],
 &quot;js_requirements&quot;=&gt;{&quot;mathjax&quot;=&gt;nil, &quot;mermaid&quot;=&gt;false},
 &quot;short_id&quot;=&gt;&quot;T00214&quot;,
 &quot;symlink&quot;=&gt;nil,
 &quot;url&quot;=&gt;&quot;/topics/proteomics/tutorials/database-handling/tutorial.html&quot;,
 &quot;topic_name&quot;=&gt;&quot;proteomics&quot;,
 &quot;tutorial_name&quot;=&gt;&quot;database-handling&quot;,
 &quot;dir&quot;=&gt;&quot;topics/proteomics/tutorials/database-handling&quot;,
 &quot;redirect_from&quot;=&gt;[&quot;/short/proteomics/database-handling&quot;, &quot;/short/T00214&quot;],
 &quot;id&quot;=&gt;&quot;proteomics/database-handling&quot;,
 &quot;ref&quot;=&gt;#&lt;Jekyll::Page @relative_path=&quot;topics/proteomics/tutorials/database-handling/tutorial.md&quot;&gt;,
 &quot;ref_tutorials&quot;=&gt;[#&lt;Jekyll::Page @relative_path=&quot;topics/proteomics/tutorials/database-handling/tutorial.md&quot;&gt;],                                                                                                    &quot;ref_slides&quot;=&gt;[],                                                                                                                                                                                                 &quot;hands_on&quot;=&gt;true,                                                                                                                                                                                                 &quot;slides&quot;=&gt;false,                                                                                                                                                                                                  &quot;mod_date&quot;=&gt;2023-11-09 09:55:09 +0100,
 &quot;pub_date&quot;=&gt;2017-02-14 13:20:30 +0100,
 &quot;version&quot;=&gt;29,
 &quot;workflows&quot;=&gt;
 &quot;workflows&quot;=&gt;
  [{&quot;workflow&quot;=&gt;&quot;wf_database-handling.ga&quot;,
    &quot;tests&quot;=&gt;false,
    &quot;url&quot;=&gt;&quot;https://training.galaxyproject.org/training-material/topics/proteomics/tutorials/database-handling/workflows/wf_database-handling.ga&quot;,
    &quot;url_html&quot;=&gt;&quot;https://training.galaxyproject.org/training-material/topics/proteomics/tutorials/database-handling/workflows/wf_database-handling.html&quot;,
    &quot;path&quot;=&gt;&quot;topics/proteomics/tutorials/database-handling/workflows/wf_database-handling.ga&quot;,
    &quot;wfid&quot;=&gt;&quot;proteomics-database-handling&quot;,
    &quot;wfname&quot;=&gt;&quot;wf-database-handling&quot;,
    &quot;trs_endpoint&quot;=&gt;&quot;https://training.galaxyproject.org/training-material/api/ga4gh/trs/v2/tools/proteomics-database-handling/versions/wf-database-handling&quot;,
    &quot;license&quot;=&gt;nil,
    &quot;parent_id&quot;=&gt;&quot;proteomics/database-handling&quot;,
    &quot;topic_id&quot;=&gt;&quot;proteomics&quot;,
    &quot;tutorial_id&quot;=&gt;&quot;database-handling&quot;,
    &quot;creators&quot;=&gt;[],
    &quot;name&quot;=&gt;&quot;Proteomics: database handling&quot;,
    &quot;title&quot;=&gt;&quot;Proteomics: database handling&quot;,
    &quot;version&quot;=&gt;5,
    &quot;description&quot;=&gt;&quot;Protein FASTA Database Handling&quot;,
    &quot;tags&quot;=&gt;[&quot;proteomics&quot;],
    &quot;features&quot;=&gt;{&quot;report&quot;=&gt;nil, &quot;subworkflows&quot;=&gt;false, &quot;comments&quot;=&gt;false, &quot;parameters&quot;=&gt;false},
    &quot;workflowhub_id&quot;=&gt;&quot;1204&quot;,
    &quot;history&quot;=&gt;[],
    &quot;test_results&quot;=&gt;nil,
    &quot;modified&quot;=&gt;2024-03-18 12:38:44.394831189 +0100,
    &quot;mermaid&quot;=&gt;
     &quot;flowchart TD\n  0[\&quot;Protein Database Downloader\&quot;];\n  1[\&quot;Protein Database Downloader\&quot;];\n  2[\&quot;FASTA-to-Tabular\&quot;];\n  0 --&gt;|output_database| 2;\n  3[\&quot;Add column\&quot;];\n  2 --&gt;|output| 3;\n  4[\&quot;Tabular
-to-FASTA\&quot;];\n  3 --&gt;|out_file1| 4;\n  5[\&quot;FASTA Merge Files and Filter Unique Sequences\&quot;];\n  4 --&gt;|output| 5;\n  1 --&gt;|output_database| 5;\n  6[\&quot;DecoyDatabase\&quot;];\n  5 --&gt;|output| 6;&quot;,
    &quot;graph_dot&quot;=&gt;
     &quot;digraph main {\n  node [fontname=\&quot;Atkinson Hyperlegible\&quot;, shape=box, color=white,style=filled,color=peachpuff,margin=\&quot;0.2,0.2\&quot;];\n  edge [fontname=\&quot;Atkinson Hyperlegible\&quot;];\n  0[label=\&quot;Protein Data
base Downloader\&quot;]\n  1[label=\&quot;Protein Database Downloader\&quot;]\n  2[label=\&quot;FASTA-to-Tabular\&quot;]\n  0 -&gt; 2 [label=\&quot;output_database\&quot;]\n  3[label=\&quot;Add column\&quot;]\n  2 -&gt; 3 [label=\&quot;output\&quot;]\n  4[label=\&quot;Tabular
-to-FASTA\&quot;]\n  3 -&gt; 4 [label=\&quot;out_file1\&quot;]\n  5[label=\&quot;FASTA Merge Files and Filter Unique Sequences\&quot;]\n  4 -&gt; 5 [label=\&quot;output\&quot;]\n  1 -&gt; 5 [label=\&quot;output_database\&quot;]\n  6[label=\&quot;DecoyDatabase\&quot;]\n  5 -
&gt; 6 [label=\&quot;output\&quot;]\n}&quot;,
    &quot;workflow_tools&quot;=&gt;
     [&quot;addValue&quot;,
      &quot;toolshed.g2.bx.psu.edu/repos/devteam/fasta_to_tabular/fasta2tab/1.1.1&quot;,
      &quot;toolshed.g2.bx.psu.edu/repos/devteam/tabular_to_fasta/tab2fasta/1.1.1&quot;,
      &quot;toolshed.g2.bx.psu.edu/repos/galaxyp/dbbuilder/dbbuilder/0.3.1&quot;,
      &quot;toolshed.g2.bx.psu.edu/repos/galaxyp/fasta_merge_files_and_filter_unique_sequences/fasta_merge_files_and_filter_unique_sequences/1.2.0&quot;,
      &quot;toolshed.g2.bx.psu.edu/repos/galaxyp/openms_decoydatabase/DecoyDatabase/2.6+galaxy0&quot;],
    &quot;inputs&quot;=&gt;[],
    &quot;outputs&quot;=&gt;
     [{&quot;annotation&quot;=&gt;&quot;&quot;,
       &quot;content_id&quot;=&gt;&quot;toolshed.g2.bx.psu.edu/repos/galaxyp/dbbuilder/dbbuilder/0.3.1&quot;,
       &quot;errors&quot;=&gt;nil,
       &quot;id&quot;=&gt;0,
       &quot;input_connections&quot;=&gt;{},
       &quot;inputs&quot;=&gt;[],
       &quot;label&quot;=&gt;nil,
       &quot;name&quot;=&gt;&quot;Protein Database Downloader&quot;,
       &quot;outputs&quot;=&gt;[{&quot;name&quot;=&gt;&quot;output_database&quot;, &quot;type&quot;=&gt;&quot;fasta&quot;}],
       &quot;position&quot;=&gt;{&quot;bottom&quot;=&gt;380.6000061035156, &quot;height&quot;=&gt;102.60000610351562, &quot;left&quot;=&gt;-110, &quot;right&quot;=&gt;90, &quot;top&quot;=&gt;278, &quot;width&quot;=&gt;200, &quot;x&quot;=&gt;-110, &quot;y&quot;=&gt;278},
       &quot;post_job_actions&quot;=&gt;{},
       &quot;tool_id&quot;=&gt;&quot;toolshed.g2.bx.psu.edu/repos/galaxyp/dbbuilder/dbbuilder/0.3.1&quot;,
       &quot;tool_shed_repository&quot;=&gt;{&quot;changeset_revision&quot;=&gt;&quot;c1b437242fee&quot;, &quot;name&quot;=&gt;&quot;dbbuilder&quot;, &quot;owner&quot;=&gt;&quot;galaxyp&quot;, &quot;tool_shed&quot;=&gt;&quot;toolshed.g2.bx.psu.edu&quot;},
       &quot;tool_state&quot;=&gt;
        &quot;{\&quot;__input_ext\&quot;: \&quot;data\&quot;, \&quot;chromInfo\&quot;: \&quot;/opt/galaxy/tool-data/shared/ucsc/chrom/?.len\&quot;, \&quot;source\&quot;: {\&quot;from\&quot;: \&quot;cRAP\&quot;, \&quot;__current_case__\&quot;: 1}, \&quot;__page__\&quot;: null, \&quot;__rerun_remap_job_id__\&quot;:
null}&quot;,
       &quot;tool_version&quot;=&gt;&quot;0.3.1&quot;,
       &quot;type&quot;=&gt;&quot;tool&quot;,
       &quot;uuid&quot;=&gt;&quot;6613b72c-2bab-423c-88fc-05edfe9ea8ec&quot;,
       &quot;workflow_outputs&quot;=&gt;[{&quot;label&quot;=&gt;nil, &quot;output_name&quot;=&gt;&quot;output_database&quot;, &quot;uuid&quot;=&gt;&quot;2d289b03-c396-46a2-a725-987b6c75ada9&quot;}]},
      ...
 &quot;api&quot;=&gt;&quot;https://training.galaxyproject.org/training-material/api/topics/proteomics/tutorials/database-handling/tutorial.json&quot;,
 &quot;tools&quot;=&gt;
  [&quot;addValue&quot;,
   &quot;toolshed.g2.bx.psu.edu/repos/devteam/fasta_to_tabular/fasta2tab/1.1.1&quot;,
   &quot;toolshed.g2.bx.psu.edu/repos/devteam/tabular_to_fasta/tab2fasta/1.1.1&quot;,
   &quot;toolshed.g2.bx.psu.edu/repos/galaxyp/dbbuilder/dbbuilder/0.3.1&quot;,
   &quot;toolshed.g2.bx.psu.edu/repos/galaxyp/fasta_merge_files_and_filter_unique_sequences/fasta_merge_files_and_filter_unique_sequences/1.2.0&quot;,
   &quot;toolshed.g2.bx.psu.edu/repos/galaxyp/openms_decoydatabase/DecoyDatabase/2.6+galaxy0&quot;],
 &quot;supported_servers&quot;=&gt;
  {&quot;exact&quot;=&gt;[{&quot;url&quot;=&gt;&quot;https://usegalaxy.eu&quot;, &quot;name&quot;=&gt;&quot;UseGalaxy.eu&quot;, &quot;usegalaxy&quot;=&gt;true}, {&quot;url&quot;=&gt;&quot;https://usegalaxy.org.au&quot;, &quot;name&quot;=&gt;&quot;UseGalaxy.org.au&quot;, &quot;usegalaxy&quot;=&gt;true}],
   &quot;inexact&quot;=&gt;[{&quot;url&quot;=&gt;&quot;https://usegalaxy.no/&quot;, &quot;name&quot;=&gt;&quot;UseGalaxy.no&quot;, &quot;usegalaxy&quot;=&gt;false}]},
 &quot;supported_servers_matrix&quot;=&gt;
  {&quot;servers&quot;=&gt;
    [{&quot;url&quot;=&gt;&quot;http://aspendb.uga.edu:8085/&quot;, &quot;name&quot;=&gt;&quot;AGEseq @ AspenDB&quot;},
     {&quot;url&quot;=&gt;&quot;http://motherbox.chemeng.ntua.gr/anastasia_dev/&quot;, &quot;name&quot;=&gt;&quot;ANASTASIA&quot;},
      ...
   &quot;tools&quot;=&gt;
    [{&quot;id&quot;=&gt;&quot;addValue&quot;,
      &quot;servers&quot;=&gt;
       [{&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://aspendb.uga.edu:8085/&quot;},
        {&quot;state&quot;=&gt;&quot;missing&quot;, &quot;server&quot;=&gt;&quot;http://motherbox.chemeng.ntua.gr/anastasia_dev/&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://apostl.moffitt.org/&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://smile.hku.hk/SARGs&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://bf2i-galaxy.insa-lyon.fr:8080/&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://143.169.238.104/galaxy/&quot;},
        {&quot;state&quot;=&gt;&quot;missing&quot;, &quot;server&quot;=&gt;&quot;https://iris.angers.inra.fr/galaxypub-cfbp&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;https://cpt.tamu.edu/galaxy-public/&quot;},
        {&quot;state&quot;=&gt;&quot;missing&quot;, &quot;server&quot;=&gt;&quot;https://vm-chemflow-francegrille.eu/&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;https://hyperbrowser.uio.no/coloc-stats&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://corgat.cloud.ba.infn.it/galaxy&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://cropgalaxy.excellenceinbreeding.org/&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://dintor.eurac.edu/&quot;},
        {&quot;state&quot;=&gt;&quot;missing&quot;, &quot;server&quot;=&gt;&quot;http://www.freebioinfo.org/&quot;},
        {&quot;state&quot;=&gt;&quot;local&quot;, &quot;server&quot;=&gt;&quot;http://igg.cloud.ba.infn.it/galaxy&quot;},
 &quot;topic_name_human&quot;=&gt;&quot;Proteomics&quot;,
 &quot;admin_install&quot;=&gt;
  {&quot;install_tool_dependencies&quot;=&gt;true,
   &quot;install_repository_dependencies&quot;=&gt;true,
   &quot;install_resolver_dependencies&quot;=&gt;true,
   &quot;tools&quot;=&gt;
    [{&quot;name&quot;=&gt;&quot;fasta_to_tabular&quot;, &quot;owner&quot;=&gt;&quot;devteam&quot;, &quot;revisions&quot;=&gt;&quot;e7ed3c310b74&quot;, &quot;tool_panel_section_label&quot;=&gt;&quot;FASTA/FASTQ&quot;, &quot;tool_shed_url&quot;=&gt;&quot;https://toolshed.g2.bx.psu.edu/&quot;},
     {&quot;name&quot;=&gt;&quot;tabular_to_fasta&quot;, &quot;owner&quot;=&gt;&quot;devteam&quot;, &quot;revisions&quot;=&gt;&quot;0a7799698fe5&quot;, &quot;tool_panel_section_label&quot;=&gt;&quot;FASTA/FASTQ&quot;, &quot;tool_shed_url&quot;=&gt;&quot;https://toolshed.g2.bx.psu.edu/&quot;},
     {&quot;name&quot;=&gt;&quot;dbbuilder&quot;, &quot;owner&quot;=&gt;&quot;galaxyp&quot;, &quot;revisions&quot;=&gt;&quot;c1b437242fee&quot;, &quot;tool_panel_section_label&quot;=&gt;&quot;Get Data&quot;, &quot;tool_shed_url&quot;=&gt;&quot;https://toolshed.g2.bx.psu.edu/&quot;},
     {&quot;name&quot;=&gt;&quot;fasta_merge_files_and_filter_unique_sequences&quot;, &quot;owner&quot;=&gt;&quot;galaxyp&quot;, &quot;revisions&quot;=&gt;&quot;f546e7278f04&quot;, &quot;tool_panel_section_label&quot;=&gt;&quot;FASTA/FASTQ&quot;, &quot;tool_shed_url&quot;=&gt;&quot;https://toolshed.g2.bx.psu.edu/&quot;},
     {&quot;name&quot;=&gt;&quot;openms_decoydatabase&quot;, &quot;owner&quot;=&gt;&quot;galaxyp&quot;, &quot;revisions&quot;=&gt;&quot;370141bc0da3&quot;, &quot;tool_panel_section_label&quot;=&gt;&quot;Proteomics&quot;, &quot;tool_shed_url&quot;=&gt;&quot;https://toolshed.g2.bx.psu.edu/&quot;}]},
 &quot;admin_install_yaml&quot;=&gt;
  &quot;---\ninstall_tool_dependencies: true\ninstall_repository_dependencies: true\ninstall_resolver_dependencies: true\ntools:\n- name: fasta_to_tabular\n  owner: devteam\n  revisions: e7ed3c310b74\n  tool_panel_s
ection_label: FASTA/FASTQ\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: tabular_to_fasta\n  owner: devteam\n  revisions: 0a7799698fe5\n  tool_panel_section_label: FASTA/FASTQ\n  tool_shed_url: http
s://toolshed.g2.bx.psu.edu/\n- name: dbbuilder\n  owner: galaxyp\n  revisions: c1b437242fee\n  tool_panel_section_label: Get Data\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: fasta_merge_files_and
_filter_unique_sequences\n  owner: galaxyp\n  revisions: f546e7278f04\n  tool_panel_section_label: FASTA/FASTQ\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n- name: openms_decoydatabase\n  owner: galaxyp\n
  revisions: 370141bc0da3\n  tool_panel_section_label: Proteomics\n  tool_shed_url: https://toolshed.g2.bx.psu.edu/\n&quot;,
 &quot;tours&quot;=&gt;false,
 &quot;video&quot;=&gt;false,
 &quot;slides_recordings&quot;=&gt;false,
 &quot;translations&quot;=&gt;{&quot;tutorial&quot;=&gt;[], &quot;slides&quot;=&gt;[], &quot;video&quot;=&gt;false},
 &quot;license&quot;=&gt;&quot;CC-BY-4.0&quot;,
 &quot;type&quot;=&gt;&quot;tutorial&quot;}</pre>
</li></ul>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="resolve_material-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 780</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">resolve_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">material</span>)
  <span class="ruby-comment"># We&#39;ve already</span>
  <span class="ruby-comment"># looked in every /topic/*/tutorials/* folder, and turn these disparate</span>
  <span class="ruby-comment"># resources into a page_obj as well. Most variables are copied directly,</span>
  <span class="ruby-comment"># either from a tutorial, or a slides (if no tutorial is available.) This</span>
  <span class="ruby-comment"># means we do not (cannot) support external_slides AND external_handson.</span>
  <span class="ruby-comment"># This is probably a sub-optimal situation we&#39;ll end up fixing someday.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">tutorials</span> = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial&#39;</span> }
  <span class="ruby-identifier">slides</span>    = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;slides&#39;</span> }
  <span class="ruby-identifier">tours</span>     = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tours&#39;</span> }

  <span class="ruby-comment"># Our final &quot;page&quot; object (a &quot;material&quot;)</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">slide_has_video</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">slide_has_recordings</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">slide_translations</span> = []
  <span class="ruby-identifier">page_ref</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">slides</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">page</span> = <span class="ruby-identifier">slides</span>.<span class="ruby-identifier">min</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> }[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">slide_has_video</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;video&#39;</span>, <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">slide_has_recordings</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;recordings&#39;</span>, <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">slide_translations</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;translations&#39;</span>, [])
    <span class="ruby-identifier">page_ref</span> = <span class="ruby-identifier">page</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># No matter if there were slides, we override with tutorials if present.</span>
  <span class="ruby-identifier">tutorial_translations</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tutorials</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">page</span> = <span class="ruby-identifier">tutorials</span>.<span class="ruby-identifier">min</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> }[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">tutorial_translations</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;translations&#39;</span>, [])
    <span class="ruby-identifier">page_ref</span> = <span class="ruby-identifier">page</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-string">&#39;[GTN/TopicFilter] Could not process material&#39;</span>
    <span class="ruby-keyword">return</span> {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Otherwise clone the metadata from it which works well enough.</span>
  <span class="ruby-identifier">page_obj</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;id&#39;</span>] = <span class="ruby-node">&quot;#{page[&#39;topic_name&#39;]}/#{page[&#39;tutorial_name&#39;]}&quot;</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;ref&#39;</span>] = <span class="ruby-identifier">page_ref</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;ref_tutorials&#39;</span>] = <span class="ruby-identifier">tutorials</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>] }
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;ref_slides&#39;</span>] = <span class="ruby-identifier">slides</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>] }

  <span class="ruby-identifier">id</span> = <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;id&#39;</span>]

  <span class="ruby-comment"># Sometimes `hands_on` is set to something like `external`, in which</span>
  <span class="ruby-comment"># case it is important to not override it. So we only do that if the</span>
  <span class="ruby-comment"># key isn&#39;t already set. Then we choose to set it to a test for the</span>
  <span class="ruby-comment"># tutorial being present. We probably don&#39;t need to test both, but it</span>
  <span class="ruby-comment"># is hard to follow which keys are which and safer to test for both in</span>
  <span class="ruby-comment"># case someone edits the code later. If either of these exist, we can</span>
  <span class="ruby-comment"># automatically set `hands_on: true`</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;hands_on&#39;</span>] = <span class="ruby-identifier">tutorials</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;hands_on&#39;</span>)

  <span class="ruby-comment"># Same for slides, if there&#39;s a resource by that name, we can</span>
  <span class="ruby-comment"># automatically set `slides: true`</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;slides&#39;</span>] = <span class="ruby-identifier">slides</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;slides&#39;</span>)

  <span class="ruby-identifier">all_resources</span> = <span class="ruby-identifier">slides</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tutorials</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;mod_date&#39;</span>] = <span class="ruby-identifier">all_resources</span>
                         .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">p</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span>) }
                         .<span class="ruby-identifier">max</span>

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;pub_date&#39;</span>] = <span class="ruby-identifier">all_resources</span>
                         .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">PublicationTimes</span>.<span class="ruby-identifier">obtain_time</span>(<span class="ruby-identifier">p</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span>) }
                         .<span class="ruby-identifier">min</span>

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;version&#39;</span>] = <span class="ruby-identifier">all_resources</span>
                        .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_modification_count</span>(<span class="ruby-identifier">p</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span>) }
                        .<span class="ruby-identifier">max</span>

  <span class="ruby-identifier">folder</span> = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;dir&#39;</span>]

  <span class="ruby-identifier">ymls</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/quiz/*.yml&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/quiz/*.yaml&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ymls</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">quizzes</span> = <span class="ruby-identifier">ymls</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)[<span class="ruby-value">-1</span>] }
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;quiz&#39;</span>] = <span class="ruby-identifier">quizzes</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">quiz_data</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-node">&quot;#{folder}/quiz/#{q}&quot;</span>)
      <span class="ruby-identifier">quiz_data</span>[<span class="ruby-string">&#39;id&#39;</span>] = <span class="ruby-identifier">q</span>
      <span class="ruby-identifier">quiz_data</span>[<span class="ruby-string">&#39;path&#39;</span>] = <span class="ruby-node">&quot;#{folder}/quiz/#{q}&quot;</span>
      <span class="ruby-identifier">quiz_data</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># In dev configuration, this breaks for me. Not sure why config isn&#39;t available.</span>
  <span class="ruby-identifier">domain</span> = <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">site</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;url&#39;</span>)
             <span class="ruby-node">&quot;#{site.config[&#39;url&#39;]}#{site.config[&#39;baseurl&#39;]}&quot;</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-string">&#39;http://localhost:4000/training-material/&#39;</span>
           <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Similar as above.</span>
  <span class="ruby-identifier">workflows</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/workflows/*.ga&quot;</span>) <span class="ruby-comment"># TODO: support gxformat2</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflows</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">workflow_names</span> = <span class="ruby-identifier">workflows</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)[<span class="ruby-value">-1</span>] }
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;workflows&#39;</span>] = <span class="ruby-identifier">workflow_names</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wf</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">wfid</span> = <span class="ruby-node">&quot;#{page[&#39;topic_name&#39;]}-#{page[&#39;tutorial_name&#39;]}&quot;</span>
      <span class="ruby-identifier">wfname</span> = <span class="ruby-identifier">wf</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/.ga/</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[^a-z0-9]/</span>, <span class="ruby-string">&#39;-&#39;</span>)
      <span class="ruby-identifier">trs</span> = <span class="ruby-node">&quot;api/ga4gh/trs/v2/tools/#{wfid}/versions/#{wfname}&quot;</span>
      <span class="ruby-identifier">wf_path</span> = <span class="ruby-node">&quot;#{folder}/workflows/#{wf}&quot;</span>
      <span class="ruby-identifier">wf_json</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">wf_path</span>))
      <span class="ruby-identifier">license</span> = <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;license&#39;</span>]
      <span class="ruby-identifier">creators</span> = <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;creator&#39;</span>] <span class="ruby-operator">||</span> []
      <span class="ruby-identifier">wftitle</span> = <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;name&#39;</span>]

      <span class="ruby-comment"># /galaxy-intro-101-workflow.eu.json</span>
      <span class="ruby-identifier">workflow_test_results</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">wf_path</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/.ga$/</span>, <span class="ruby-string">&#39;.*.json&#39;</span>))
      <span class="ruby-identifier">workflow_test_outputs</span> = {}
      <span class="ruby-identifier">workflow_test_results</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">test_result</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">server</span> = <span class="ruby-identifier">workflow_test_results</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/\.(..)\.json$/</span>)[<span class="ruby-value">1</span>]
        <span class="ruby-identifier">workflow_test_outputs</span>[<span class="ruby-identifier">server</span>] = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">test_result</span>))
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">workflow_test_outputs</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflow_test_outputs</span>.<span class="ruby-identifier">empty?</span>

      <span class="ruby-identifier">wfhkey</span> = [<span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;topic_name&#39;</span>], <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>], <span class="ruby-identifier">wfname</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;/&#39;</span>)

      {
        <span class="ruby-string">&#39;workflow&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf</span>,
        <span class="ruby-string">&#39;tests&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/workflows/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">wf</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/.ga/</span>, <span class="ruby-string">&#39;-test*&#39;</span>)).<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>,
        <span class="ruby-string">&#39;url&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{domain}/#{folder}/workflows/#{wf}&quot;</span>,
        <span class="ruby-string">&#39;url_html&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{domain}/#{folder}/workflows/#{wf.gsub(/.ga$/, &#39;.html&#39;)}&quot;</span>,
        <span class="ruby-string">&#39;path&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_path</span>,
        <span class="ruby-string">&#39;wfid&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wfid</span>,
        <span class="ruby-string">&#39;wfname&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wfname</span>,
        <span class="ruby-string">&#39;trs_endpoint&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{domain}/#{trs}&quot;</span>,
        <span class="ruby-string">&#39;license&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">license</span>,
        <span class="ruby-string">&#39;parent_id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;id&#39;</span>],
        <span class="ruby-string">&#39;topic_id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;topic_name&#39;</span>],
        <span class="ruby-string">&#39;tutorial_id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">page</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>],
        <span class="ruby-string">&#39;creators&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">creators</span>,
        <span class="ruby-string">&#39;name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;name&#39;</span>],
        <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wftitle</span>,
        <span class="ruby-string">&#39;version&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">ModificationTimes</span>.<span class="ruby-identifier">obtain_modification_count</span>(<span class="ruby-identifier">wf_path</span>),
        <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;annotation&#39;</span>],
        <span class="ruby-string">&#39;tags&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;tags&#39;</span>],
        <span class="ruby-string">&#39;features&#39;</span> <span class="ruby-operator">=&gt;</span> {
          <span class="ruby-string">&#39;report&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;report&#39;</span>],
          <span class="ruby-string">&#39;subworkflows&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;type&#39;</span>]}.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;subworkflow&quot;</span>},
          <span class="ruby-string">&#39;comments&#39;</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;comments&#39;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>,
          <span class="ruby-string">&#39;parameters&#39;</span> <span class="ruby-operator">=&gt;</span>  <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;type&#39;</span>]}.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;parameter_input&quot;</span>},
        },
        <span class="ruby-string">&#39;workflowhub_id&#39;</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;workflowhub&#39;</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">wfhkey</span>, <span class="ruby-keyword">nil</span>),
        <span class="ruby-string">&#39;history&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">git_log</span>(<span class="ruby-identifier">wf_path</span>),
        <span class="ruby-string">&#39;test_results&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">workflow_test_outputs</span>,
        <span class="ruby-string">&#39;modified&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">wf_path</span>),
        <span class="ruby-string">&#39;mermaid&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">mermaid</span>(<span class="ruby-identifier">wf_json</span>),
        <span class="ruby-string">&#39;graph_dot&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">graph_dot</span>(<span class="ruby-identifier">wf_json</span>),
        <span class="ruby-string">&#39;workflow_tools&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">extract_workflow_tool_list</span>(<span class="ruby-identifier">wf_json</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>,
        <span class="ruby-string">&#39;inputs&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> [<span class="ruby-string">&#39;data_input&#39;</span>, <span class="ruby-string">&#39;data_collection_input&#39;</span>, <span class="ruby-string">&#39;parameter_input&#39;</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;type&#39;</span>] }.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>},
        <span class="ruby-string">&#39;outputs&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;workflow_outputs&#39;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;workflow_outputs&#39;</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span> }.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>},
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Really only used for tool list install for ephemeris, not general.</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;api&#39;</span>] = <span class="ruby-node">&quot;#{domain}/api/topics/#{page[&#39;topic_name&#39;]}/tutorials/#{page[&#39;tutorial_name&#39;]}/tutorial.json&quot;</span>

  <span class="ruby-comment"># Tool List</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># This is exposed in the GTN API to help admins/devs easily get the tool</span>
  <span class="ruby-comment"># list for installation.</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] = []
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">content</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/{% tool \[[^\]]*\]\(([^)]*)\)\s*%}/</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;hands_on&#39;</span>]

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;workflows&#39;</span>]&amp;.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wf</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">wf_path</span> = <span class="ruby-node">&quot;#{folder}/workflows/#{wf[&#39;workflow&#39;]}&quot;</span>

    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">wf</span>[<span class="ruby-string">&#39;workflow_tools&#39;</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] = <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">topic</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]]
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;supported_servers&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;use&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;basics&#39;</span>
                                    <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Supported</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;public-server-tools&#39;</span>], <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>])
                                  <span class="ruby-keyword">else</span>
                                    []
                                  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;supported_servers_matrix&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;use&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;basics&#39;</span>
    <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Supported</span>.<span class="ruby-identifier">calculate_matrix</span>(<span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;public-server-tools&#39;</span>], <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>])
  <span class="ruby-keyword">else</span>
    []
  <span class="ruby-keyword">end</span>


  <span class="ruby-identifier">topic_name_human</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]][<span class="ruby-string">&#39;title&#39;</span>]
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;topic_name_human&#39;</span>] = <span class="ruby-identifier">topic_name_human</span> <span class="ruby-comment"># TODO: rename &#39;topic_name&#39; and &#39;topic_name&#39; to &#39;topic_id&#39;</span>
  <span class="ruby-identifier">admin_install</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Toolshed</span>.<span class="ruby-identifier">format_admin_install</span>(<span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;toolshed-revisions&#39;</span>], <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>],
                                                     <span class="ruby-identifier">topic_name_human</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;toolcats&#39;</span>])
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;admin_install&#39;</span>] = <span class="ruby-identifier">admin_install</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;admin_install_yaml&#39;</span>] = <span class="ruby-identifier">admin_install</span>.<span class="ruby-identifier">to_yaml</span>

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tours&#39;</span>] = <span class="ruby-identifier">tours</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video&#39;</span>] = <span class="ruby-identifier">slide_has_video</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;slides_recordings&#39;</span>] = <span class="ruby-identifier">slide_has_recordings</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>] = {}
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>][<span class="ruby-string">&#39;tutorial&#39;</span>] = <span class="ruby-identifier">tutorial_translations</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>][<span class="ruby-string">&#39;slides&#39;</span>] = <span class="ruby-identifier">slide_translations</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>][<span class="ruby-string">&#39;video&#39;</span>] = <span class="ruby-identifier">slide_has_video</span> <span class="ruby-comment"># Just demand it?</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;license&#39;</span>] = <span class="ruby-string">&#39;CC-BY-4.0&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;license&#39;</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment"># I feel less certain about this override, but it works well enough in</span>
  <span class="ruby-comment"># practice, and I did not find any examples of `type: &lt;anything other</span>
  <span class="ruby-comment"># than tutorial&gt;` in topics/*/tutorials/*/tutorial.md but that doesn&#39;t</span>
  <span class="ruby-comment"># make it future proof.</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;tutorial&#39;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;draft&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;draft&#39;</span>]
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tags&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span> <span class="ruby-string">&#39;tags&#39;</span>
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tags&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;work-in-progress&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">page_obj</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-short_tool" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-short_tool" title="Link to this method">
                            <span class="method-name">short_tool</span>
                            <span class="method-args">(tool)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>Get a short version of a tool. Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>tool</code></dt>
<dd>
<p>A tool string</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code></dt>
<dd>
<p>The short version of the tool.</p>
</dd></dl>

<p>Examples: <a href="TopicFilter.html#method-c-short_tool"><code>short_tool</code></a>(“toolshed.g2.bx.psu.edu/repos/galaxyp/regex_find_replace/regex1/1.0.0”) =&gt; “galaxyp/regex1”</p>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="short_tool-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 1182</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">short_tool</span>(<span class="ruby-identifier">tool</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tool</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&#39;/&#39;</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span>
    <span class="ruby-node">&quot;#{tool.split(&#39;/&#39;)[2]}/#{tool.split(&#39;/&#39;)[3]}/#{tool.split(&#39;/&#39;)[4]}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tool</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
                  <div id="method-c-topic_filter" class="method-detail ">
                    <div class="method-header">
                        <div class="method-heading">
                          <a href="#method-c-topic_filter" title="Link to this method">
                            <span class="method-name">topic_filter</span>
                            <span class="method-args">(site, topic_name)</span>
                          </a>
                        </div>
                    </div>

                      <div class="method-description">
                          <p>This function returns a list of all the materials that are available for a specific topic. Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code></dt>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>topic_name</code></dt>
<dd>
<p>The name of the topic</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code></dt>
<dd>
<p>The list of materials</p>
</dd></dl>
 
                          <button class="toggle-source">toggle source</button>
                          <div class="method-source-code" id="topic_filter-source">
                            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">topic_filter</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
  <span class="ruby-identifier">fill_cache</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic_name</span>]
<span class="ruby-keyword">end</span></pre>
                          </div>
                      </div>


                  </div>
              </section>

      </article>
      <nav class="contextual">
        
        
        
        
        
        

        
  <div class="nav-section">
    <h3>Class Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-c-annotate_path">annotate_path</a></li>
      <li ><a href="#method-c-cache">cache</a></li>
      <li ><a href="#method-c-collate_materials">collate_materials</a></li>
      <li ><a href="#method-c-enumerate_topics">enumerate_topics</a></li>
      <li ><a href="#method-c-extract_workflow_tool_list">extract_workflow_tool_list</a></li>
      <li ><a href="#method-c-fetch_tutorial_material">fetch_tutorial_material</a></li>
      <li ><a href="#method-c-fill_cache">fill_cache</a></li>
      <li ><a href="#method-c-filter_by_tag">filter_by_tag</a></li>
      <li ><a href="#method-c-filter_by_topic">filter_by_topic</a></li>
      <li ><a href="#method-c-filter_by_topic_subtopic">filter_by_topic_subtopic</a></li>
      <li ><a href="#method-c-get_posts">get_posts</a></li>
      <li ><a href="#method-c-get_version">get_version</a></li>
      <li ><a href="#method-c-git_log">git_log</a></li>
      <li ><a href="#method-c-graph_dot">graph_dot</a></li>
      <li ><a href="#method-c-identify_contributors">identify_contributors</a></li>
      <li ><a href="#method-c-identify_funders_and_grants">identify_funders_and_grants</a></li>
      <li ><a href="#method-c-list_all_materials">list_all_materials</a></li>
      <li ><a href="#method-c-list_all_tags">list_all_tags</a></li>
      <li ><a href="#method-c-list_materials_by_tool">list_materials_by_tool</a></li>
      <li ><a href="#method-c-list_materials_structured">list_materials_structured</a></li>
      <li ><a href="#method-c-list_topics">list_topics</a></li>
      <li ><a href="#method-c-list_topics_h">list_topics_h</a></li>
      <li ><a href="#method-c-list_videos">list_videos</a></li>
      <li ><a href="#method-c-mermaid">mermaid</a></li>
      <li ><a href="#method-c-mermaid_safe_label">mermaid_safe_label</a></li>
      <li ><a href="#method-c-process_pages">process_pages</a></li>
      <li ><a href="#method-c-resolve_material">resolve_material</a></li>
      <li ><a href="#method-c-short_tool">short_tool</a></li>
      <li ><a href="#method-c-topic_filter">topic_filter</a></li>
    </ul>
  </div>




      </nav>
    </main>
  </div>
</body>

